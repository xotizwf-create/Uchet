<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="theme-color" content="#1A73E8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <style>
      /* ===== Глобальные стили ===== */
      :root {
        --primary-color: #2f80ff;
        --primary-light: #5a9bff;
        --primary-dark: #1e6bff;
        --secondary-color: #34c759;
        --error-color: #ea4335;
        --warning-color: #fbbc05;
        --bg-app: #eef2f6;
        --bg-surface: #f7f9fc;
        --bg-card: #ffffff;
        --border-color: rgba(30, 41, 59, 0.08);
        --text-main: #0f172a;
        --text-muted: #64748b;
        --glass-bg: rgba(255, 255, 255, 0.82);
        --glass-border: rgba(226, 232, 240, 0.9);
        --glass-hover: rgba(30, 41, 59, 0.06);
        --glass-shadow: 0 12px 36px rgba(30, 41, 59, 0.12);
        --premium-shadow: 0 18px 40px -18px rgba(30, 41, 59, 0.35);
        --bg-gradient: none;
        --background-color: var(--bg-surface);
        --surface-color: var(--bg-app);
        --surface-strong: #0f1b34;
        --on-surface-color: var(--text-main);
        --on-surface-secondary-color: var(--text-muted);
        --divider-color: var(--border-color);
        --border-radius: 12px;
        --shadow-elevation-1: var(--glass-shadow);
        --shadow-elevation-2: 0 16px 36px rgba(31, 38, 135, 0.12);
        --shadow-elevation-4: 0 20px 50px rgba(31, 38, 135, 0.16);
        --shadow-elevation-8: 0 28px 64px rgba(31, 38, 135, 0.2);
        --font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
        --font-size-small: 12px;
        --font-size-medium: 14px;
        --font-size-large: 16px;
        --font-size-xlarge: 18px;
        --font-weight-regular: 400;
        --font-weight-medium: 500;
        --font-weight-bold: 700;
        --spacing-xs: 4px;
        --spacing-sm: 8px;
        --spacing-md: 16px;
        --spacing-lg: 24px;
        --spacing-xl: 32px;
        --text-primary: #0f172a;
        --text-muted: #94a3b8;
        --border: #e2e8f0;
        --shadow-sm: 0 6px 16px rgba(15, 23, 42, 0.06);
        --shadow-md: 0 12px 28px rgba(15, 23, 42, 0.08);
        --radius-lg: 18px;
        --radius-md: 12px;
        --control-h: 36px;
        --gap-lg: 18px;
        --gap-md: 12px;
        --brand: #4f46e5;
        --success-bg: #ecfdf3;
        --warning-bg: #fff7ed;
        --sidebar-footer-pad: 14px;
        --divider: rgba(226, 232, 240, 0.9);
        --mint-bg: #e6f9ef;
        --mint-text: #16a34a;
        --switch-w: 36px;
        --switch-h: 20px;
        --switch-thumb: 16px;
        --switch-bg: #e2e8f0;
        --switch-bg-checked: #cbd5e1;
        --switch-border: rgba(148, 163, 184, 0.45);
        --switch-border-checked: rgba(148, 163, 184, 0.6);
      }
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: var(--font-family);
        font-size: var(--font-size-medium);
        color: var(--on-surface-color);
        background-color: var(--bg-app);
        background-image: none;
        overflow: hidden; /* Чтобы не было скролла у body */
      }
      /* ===== Основной контейнер ===== */
      .app-root {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        box-shadow: none;
        border-radius: 0;
        overflow: hidden;
        background-color: transparent;
      }
      .app-shell {
        background: var(--bg-app);
        color: var(--text-primary);
      }
      .page {
        width: 100%;
      }
      .sidebar {
        background: var(--bg-card);
      }
      .sidebar-footer {
        border-top: 1px solid transparent;
      }
      .topnav {
        background: var(--bg-app);
      }
      .cards-grid {
        display: grid;
        gap: var(--gap-lg);
      }
      .card {
        background: var(--bg-card);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
      }
      .card-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
      }
      .btn {
        height: var(--control-h);
        border-radius: var(--radius-md);
        font-weight: 600;
      }
      .btn-primary {
        background: var(--brand);
        color: #fff;
      }
      .btn-secondary {
        background: #fff;
        color: var(--text-primary);
        border: 1px solid var(--border);
      }
      .switch {
        border-radius: 999px;
      }
      .timeline {
        display: flex;
        flex-direction: column;
        gap: var(--gap-md);
      }
      .timeline-dot {
        border-radius: 50%;
      }
      .timeline-line {
        width: 2px;
      }
      .empty-state {
        color: var(--text-muted);
      }
      /* ===== Глобальный экран загрузки ===== */
      .app-loading-overlay {
        position: fixed;
        inset: 0;
        display: grid;
        place-items: center;
        background: radial-gradient(circle at center, #0f172a 0%, #020617 45%, #000000 100%);
        overflow: hidden;
        z-index: 30000;
        transition: opacity 0.6s ease, visibility 0.6s ease, transform 0.6s ease, filter 0.6s ease;
      }
      .app-loading-overlay.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transform: scale(1.08);
        filter: blur(18px);
      }
      .app-loading-bg {
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at center, rgba(148, 163, 184, 0.08), transparent 55%);
      }
      .app-loading-glow {
        position: absolute;
        width: 520px;
        height: 520px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(248, 250, 252, 0.08), transparent 65%);
        filter: blur(80px);
        opacity: 0.65;
      }
      .app-loading-center {
        position: relative;
        z-index: 2;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 22px;
        color: #e2e8f0;
      }
      .app-loading-logo {
        width: 140px;
        height: 110px;
      }
      .app-loading-logo path {
        stroke: url(#liquidMetal);
        stroke-width: 1;
        stroke-linecap: round;
        stroke-linejoin: round;
        fill: none;
      }
      .app-loading-p-left {
        stroke-dasharray: 240;
        stroke-dashoffset: 240;
        animation: logoDraw 1.4s ease-in-out forwards;
      }
      .app-loading-p-right {
        stroke-dasharray: 240;
        stroke-dashoffset: 240;
        animation: logoDraw 1.4s ease-in-out forwards;
        animation-delay: 0.5s;
      }
      .app-loading-smile {
        stroke-dasharray: 260;
        stroke-dashoffset: 260;
        animation: smileDraw 1.4s ease-in-out forwards;
        animation-delay: 1.8s;
      }
      .app-loading-eye {
        transform-origin: center;
        opacity: 0;
        animation: eyePop 0.4s ease-out forwards;
        animation-delay: 2.2s;
      }
      .app-loading-eye.right {
        animation-delay: 2.35s;
      }
      .app-loading-eye.blink {
        animation: eyePop 0.4s ease-out forwards, eyeBlink 0.2s ease-in-out 3.5s;
      }
      .app-loading-eye.right.blink {
        animation: eyePop 0.4s ease-out forwards, eyeBlink 0.2s ease-in-out 3.5s;
      }
      .app-loading-title {
        font-size: 14px;
        font-weight: 300;
        text-transform: uppercase;
        letter-spacing: 0.2em;
        color: #e2e8f0;
        text-shadow: 0 0 18px rgba(255, 255, 255, 0.18);
        animation: textRise 1.6s ease-out forwards;
        animation-delay: 2.5s;
        opacity: 0;
        transform: translateY(10px);
      }
      .app-loading-line {
        position: absolute;
        bottom: 12%;
        width: 140px;
        height: 1px;
        background: rgba(148, 163, 184, 0.2);
        overflow: hidden;
      }
      .app-loading-line::after {
        content: "";
        position: absolute;
        inset: 0;
        transform: translateX(-100%);
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.9), transparent);
        animation: monoScan 2.6s ease-in-out forwards;
        animation-delay: 2.2s;
      }
      @keyframes logoDraw {
        0% { stroke-dashoffset: 240; opacity: 0; }
        100% { stroke-dashoffset: 0; opacity: 1; }
      }
      @keyframes smileDraw {
        0% { stroke-dashoffset: 260; opacity: 0; }
        100% { stroke-dashoffset: 0; opacity: 1; }
      }
      @keyframes eyePop {
        0% { opacity: 0; transform: scale(0.6); }
        100% { opacity: 1; transform: scale(1); }
      }
      @keyframes eyeBlink {
        0%, 100% { transform: scaleY(1); }
        50% { transform: scaleY(0.1); }
      }
      @keyframes textRise {
        0% { opacity: 0; letter-spacing: 0.2em; transform: translateY(10px); }
        100% { opacity: 1; letter-spacing: 0.5em; transform: translateY(0); }
      }
      @keyframes monoScan {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }
      @keyframes smileWink {
        0%, 92%, 100% { transform: scaleY(1); }
        94% { transform: scaleY(0.15); }
        96% { transform: scaleY(1); }
      }
      @keyframes smilePulse {
        0%, 100% { transform: scale(1); opacity: 0.9; }
        50% { transform: scale(1.06); opacity: 1; }
      }
      /* ===== Шапка приложения ===== */
      .app-header {
        display: none;
      }
      /* ===== Основной контент ===== */
      .app-main {
        flex: 1;
        display: flex;
        overflow: hidden;
        background: transparent;
      }
      /* ===== Левое меню ===== */
      .left-menu {
        width: 220px;
        flex: 0 0 220px;
        background: #ffffff;
        border-right: 1px solid #e2e8f0;
        display: flex;
        flex-direction: column;
        padding: 16px 0 20px;
        box-sizing: border-box;
        overflow: hidden;
        color: #0f172a;
        box-shadow: none;
        backdrop-filter: none;
        transition: width 0.28s ease, flex-basis 0.28s ease, padding 0.28s ease, opacity 0.2s ease, transform 0.28s ease;
      }
      .app-root.sidebar-collapsed .left-menu {
        width: 72px;
        flex-basis: 72px;
        padding: 14px 0 18px;
        border-right: none;
        opacity: 1;
        transform: translateX(0);
        pointer-events: auto;
      }
      .app-root.sidebar-collapsed .left-menu-logo,
      .app-root.sidebar-collapsed .left-menu-title,
      .app-root.sidebar-collapsed .left-menu-footer {
        display: none;
      }
      .app-root.sidebar-collapsed .left-menu-item {
        justify-content: center;
        padding: 12px 0;
        margin: 0 10px 8px;
      }
      .app-root.sidebar-collapsed .left-menu-label {
        display: none;
      }
      .left-menu-logo {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 0 16px 14px;
        margin-bottom: 10px;
        border-bottom: none;
      }
      .left-menu-badge {
        width: 38px;
        height: 38px;
        border-radius: 10px;
        background: linear-gradient(135deg, #4f46e5 0%, #6366f1 100%);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-weight: 700;
        box-shadow: 0 10px 20px -5px rgba(99, 102, 241, 0.35);
        position: relative;
      }
      .left-menu-badge::after {
        content: "";
        position: absolute;
        inset: -10px;
        background: radial-gradient(circle, rgba(99, 102, 241, 0.2), transparent 70%);
        z-index: -1;
        filter: blur(8px);
      }
      .left-menu-badge-smile {
        font-size: 0;
      }
      .left-menu-badge-smile svg {
        width: 22px;
        height: 22px;
        color: #ffffff;
      }
      .left-menu-badge-smile .smile-eye {
        transform-origin: center;
        animation: smileWink 6s ease-in-out infinite;
      }
      .left-menu-badge-smile .smile-eye.right {
        animation-delay: 3s;
      }
      .left-menu-badge-smile .smile-smile {
        animation: smilePulse 4.5s ease-in-out infinite;
        transform-origin: center;
      }
      .left-menu-logo-text {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .left-menu-logo-text .title {
        color: #0f172a;
        font-weight: 700;
        font-size: 16px;
      }
      .left-menu-logo-text .subtitle {
        color: #64748b;
        font-size: 11px;
        letter-spacing: 0.2em;
        text-transform: uppercase;
      }
      .left-menu-title {
        padding: 0 16px 10px 16px;
        font-size: 11px;
        font-weight: 700;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.8px;
      }
      .left-menu-item {
        padding: 10px 14px;
        margin: 0 12px 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        color: #475569;
        border-radius: 12px;
        transition: background-color 0.2s ease, color 0.2s ease, transform 0.12s ease;
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
      }
      .left-menu-item:hover {
        background-color: #f1f5f9;
        color: #0f172a;
        transform: none;
      }
      .left-menu-item.active {
        position: relative;
        background: var(--brand);
        color: #ffffff;
        font-weight: 700;
        box-shadow: 0 12px 24px rgba(79, 70, 229, 0.25);
      }
      .left-menu-item.active::after {
        content: "›";
        margin-left: auto;
        font-size: 16px;
        line-height: 1;
        color: rgba(255, 255, 255, 0.9);
      }
      .left-menu-footer {
        margin-top: auto;
        padding: var(--sidebar-footer-pad) 16px 0;
        display: flex;
        flex-direction: column;
        gap: 10px;
        border-top: 1px solid var(--divider);
      }
      .left-menu-archive-btn {
        width: 100%;
        height: 44px;
        border: none;
        border-radius: 12px;
        background: var(--mint-bg);
        color: var(--mint-text);
        font-weight: 600;
        font-size: 13px;
        padding: 0 14px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: flex-start;
        gap: 10px;
        transition: background-color 0.15s ease;
      }
      .left-menu-archive-btn:hover {
        background: #dff5ea;
        box-shadow: none;
        transform: none;
      }
      .left-menu-archive-btn:active {
        transform: translateY(0);
        box-shadow: 0 8px 16px rgba(0,0,0,0.18);
      }
      .left-menu-archive-btn:disabled {
        opacity: 0.6;
        cursor: progress;
        box-shadow: none;
        transform: none;
      }
      .left-menu-archive-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
      }
      .left-menu-archive-icon svg {
        width: 18px;
        height: 18px;
      }
      .left-menu-theme-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 0 2px;
        color: #94a3b8;
        font-size: 13px;
      }
      .left-menu-theme-info {
        display: inline-flex;
        align-items: center;
        gap: 10px;
      }
      .left-menu-theme-icon {
        width: 16px;
        height: 16px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: #94a3b8;
      }
      .left-menu-theme-icon svg {
        width: 16px;
        height: 16px;
      }
      .ui-switch {
        position: relative;
        width: var(--switch-w);
        height: var(--switch-h);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      .ui-switch input {
        position: absolute;
        inset: 0;
        opacity: 0;
        cursor: pointer;
        margin: 0;
        z-index: 2;
      }
      .ui-switch__track {
        width: 100%;
        height: 100%;
        border-radius: 999px;
        background: var(--switch-bg);
        border: 1px solid var(--switch-border);
        position: relative;
        transition: background-color 0.2s ease, border-color 0.2s ease;
      }
      .ui-switch__track::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 2px;
        width: var(--switch-thumb);
        height: var(--switch-thumb);
        transform: translateY(-50%);
        border-radius: 50%;
        background: #ffffff;
        border: 1px solid rgba(148, 163, 184, 0.4);
        box-shadow: 0 1px 2px rgba(15, 23, 42, 0.12);
        transition: left 0.2s ease;
      }
      .ui-switch input:checked + .ui-switch__track {
        background: var(--switch-bg-checked);
        border-color: var(--switch-border-checked);
      }
      .ui-switch input:checked + .ui-switch__track::before {
        left: calc(100% - var(--switch-thumb) - 2px);
      }
      .ui-switch input:focus-visible + .ui-switch__track {
        outline: none;
        box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
      }
      .left-menu-icon {
        width: 28px;
        height: 28px;
        border-radius: 10px;
        background: #eef2ff;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: #4f46e5;
        box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 8px 16px rgba(148, 163, 184, 0.2);
        transition: transform 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
      }
      .left-menu-icon svg {
        width: 18px;
        height: 18px;
        stroke: currentColor;
        stroke-width: 1.8;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
      }
      .left-menu-item:hover .left-menu-icon {
        color: #4338ca;
        background: #e0e7ff;
      }
      .left-menu-item.active .left-menu-icon {
        color: #ffffff;
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.1);
        box-shadow: 0 10px 20px rgba(79, 70, 229, 0.25);
        animation: iconBounce 0.5s ease;
      }
      @keyframes iconBounce {
        0% { transform: scale(1); }
        40% { transform: scale(1.18); }
        100% { transform: scale(1.1); }
      }
      /* ===== Рабочая область (вкладки + содержимое) ===== */
      .workspace {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        background: transparent;
        min-width: 0;
      }
      /* ===== Вкладки ===== */
      .tabs-bar {
        display: flex;
        align-items: center;
        gap: 12px;
        border-bottom: none;
        background-color: var(--bg-app);
        padding: 10px 20px;
        box-shadow: none;
        backdrop-filter: none;
      }
      .sidebar-toggle-btn {
        display: none;
      }
      .sidebar-toggle-btn {
        width: 56px;
        height: 30px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        border-radius: 999px;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        color: #3b82f6;
        padding: 3px;
        display: inline-flex;
        align-items: center;
        justify-content: flex-start;
        cursor: pointer;
        position: relative;
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
        transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, transform 0.12s ease;
      }
      .sidebar-toggle-btn::before {
        content: "";
        position: absolute;
        left: 3px;
        top: 3px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: #ffffff;
        box-shadow: 0 8px 16px rgba(15, 23, 42, 0.18);
        transition: transform 0.24s ease, box-shadow 0.2s ease, background-color 0.2s ease;
      }
      .sidebar-toggle-btn:hover {
        background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 100%);
        color: var(--text-main);
        box-shadow: 0 12px 24px rgba(15, 23, 42, 0.16);
      }
      .sidebar-toggle-btn:active {
        transform: translateY(1px);
      }
      .sidebar-toggle-icon {
        display: none;
      }
      .app-root.sidebar-collapsed .sidebar-toggle-btn {
        background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%);
        border-color: rgba(37, 99, 235, 0.35);
        color: #1d4ed8;
        box-shadow: 0 12px 26px rgba(59, 130, 246, 0.25);
      }
      .app-root.sidebar-collapsed .sidebar-toggle-btn::before {
        transform: translateX(26px);
        background: #ffffff;
      }
      .tabs-bar .sidebar-toggle-btn {
        display: none;
      }
      .tabs {
        flex: 1;
        display: flex;
        overflow-x: auto;
        overflow-y: hidden;
        scrollbar-width: thin;
        scrollbar-color: var(--on-surface-secondary-color) var(--divider-color);
        align-items: center;
        gap: 8px;
      }
      .tabs::-webkit-scrollbar {
        height: 8px;
      }
      .tabs::-webkit-scrollbar-track {
        background: var(--divider-color);
      }
      .tabs::-webkit-scrollbar-thumb {
        background-color: var(--on-surface-secondary-color);
        border-radius: 4px;
      }
      .tab {
        padding: 6px 10px;
        margin: 0;
        border-radius: 999px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        color: #94a3b8;
        background-color: transparent;
        border: 1px solid transparent;
        display: flex;
        align-items: center;
        gap: 6px;
        position: relative;
        transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
      }
      .tab:hover {
        background-color: rgba(226, 232, 240, 0.6);
        color: #1f2937;
        box-shadow: none;
      }
      .tab.active {
        background-color: #ffffff;
        color: #0f172a;
        border: 1px solid #e2e8f0;
        box-shadow: 0 10px 18px rgba(15, 23, 42, 0.08);
        transform: none;
      }
      .tab-close {
        margin-left: 6px;
        cursor: pointer;
        font-weight: 700;
        color: #94a3b8;
        opacity: 0;
        transition: opacity 0.2s ease, background-color 0.2s ease, color 0.2s ease;
        font-size: 12px;
        line-height: 1;
        display: none;
        align-items: center;
        justify-content: center;
        width: 16px;
        height: 16px;
        border-radius: 999px;
      }
      .tab:hover .tab-close,
      .tab.active .tab-close {
        opacity: 1;
      }
      .tab.active .tab-close {
        display: inline-flex;
      }
      .tab-close:hover {
        opacity: 1;
        background-color: #e2e8f0;
        color: #64748b;
      }
      .tabs-actions {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .tabs-action-btn {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        border: 1px solid #e2e8f0;
        background: #ffffff;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: #64748b;
        cursor: pointer;
        box-shadow: 0 10px 18px rgba(15, 23, 42, 0.06);
      }
      .tabs-action-btn svg {
        width: 16px;
        height: 16px;
      }
      .tabs-avatar {
        width: 32px;
        height: 32px;
        border-radius: 999px;
        background: #ffffff;
        border: 2px solid #c7d2fe;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 700;
        color: #4f46e5;
        box-shadow: 0 10px 18px rgba(15, 23, 42, 0.06);
        cursor: pointer;
      }
      .profile-menu {
        position: relative;
      }
      .profile-dropdown {
        position: absolute;
        top: calc(100% + 10px);
        right: 0;
        width: 260px;
        background: #ffffff;
        border-radius: 14px;
        box-shadow: 0 20px 40px rgba(15, 23, 42, 0.16);
        border: 1px solid #e2e8f0;
        padding: 12px 0;
        opacity: 0;
        transform: translateY(6px);
        pointer-events: none;
        transition: opacity 0.16s ease, transform 0.16s ease;
        z-index: 50;
      }
      .profile-menu.is-open .profile-dropdown {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
      }
      .profile-dropdown__header {
        padding: 4px 16px 10px;
      }
      .profile-dropdown__name {
        font-weight: 700;
        color: #0f172a;
        font-size: 14px;
      }
      .profile-dropdown__role {
        margin-top: 4px;
        font-size: 12px;
        color: #94a3b8;
      }
      .profile-dropdown__divider {
        height: 1px;
        background: #e2e8f0;
        margin: 6px 0;
      }
      .profile-dropdown__item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 16px;
        color: #334155;
        text-decoration: none;
        font-weight: 600;
        font-size: 13px;
      }
      .profile-dropdown__item:hover {
        background: #f8fafc;
      }
      .profile-dropdown__item.is-danger {
        color: #ef4444;
      }
      .profile-dropdown__accounts {
        padding: 10px 16px 6px;
      }
      .profile-dropdown__accounts[aria-hidden="true"] {
        display: none;
      }
      .profile-dropdown__accounts-title {
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #94a3b8;
        margin-bottom: 8px;
      }
      .profile-account {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 10px;
        border-radius: 10px;
        cursor: pointer;
        transition: background 0.2s ease;
        min-height: 52px;
      }
      .profile-account:hover {
        background: #f8fafc;
      }
      .profile-account.is-current {
        background: rgba(79, 70, 229, 0.1);
        cursor: default;
      }
      .profile-account__avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #eef2ff;
        color: #4f46e5;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 12px;
      }
      .profile-account__meta {
        display: flex;
        flex-direction: column;
        min-width: 0;
      }
      .profile-account__name {
        font-weight: 600;
        font-size: 13px;
        color: #0f172a;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .profile-account__email {
        font-size: 12px;
        color: #94a3b8;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .profile-account__remove {
        margin-left: auto;
        width: 26px;
        height: 26px;
        border-radius: 8px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: #94a3b8;
        font-size: 16px;
        transition: color 0.2s ease, background 0.2s ease;
      }
      .profile-account__remove:hover {
        color: #ef4444;
        background: rgba(239, 68, 68, 0.12);
      }
      .profile-dropdown__icon {
        width: 18px;
        height: 18px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: currentColor;
      }
      .profile-dropdown__icon svg {
        width: 18px;
        height: 18px;
      }
      .profile-modal {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(15, 23, 42, 0.35);
        backdrop-filter: blur(4px);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
        z-index: 60;
      }
      .profile-modal.is-open {
        opacity: 1;
        pointer-events: auto;
      }
      .profile-modal__card {
        width: 420px;
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 24px 60px rgba(15, 23, 42, 0.2);
        border: 1px solid #e2e8f0;
        overflow: hidden;
      }
      .profile-modal__header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px;
        border-bottom: 1px solid #e2e8f0;
      }
      .profile-modal__title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        color: #0f172a;
        font-size: 15px;
      }
      .profile-modal__title svg {
        width: 18px;
        height: 18px;
        color: #4f46e5;
      }
      .profile-modal__close {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        border: none;
        background: transparent;
        color: #94a3b8;
        cursor: pointer;
        font-size: 18px;
        line-height: 1;
      }
      .profile-modal__body {
        padding: 16px 20px 10px;
      }
      .profile-form__grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px;
      }
      .profile-field {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .profile-field label {
        font-size: 11px;
        font-weight: 700;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }
      .profile-modal__card {
        width: 560px;
        border-radius: 24px;
        padding: 0;
        border: 1px solid #eef2f7;
      }
      .profile-modal__header {
        padding: 22px 26px 16px;
        border-bottom: 1px solid #eef2f7;
      }
      .profile-modal__title {
        gap: 12px;
        font-size: 18px;
        font-weight: 700;
        color: #0f172a;
      }
      .profile-modal__close {
        width: 34px;
        height: 34px;
        border-radius: 10px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: #94a3b8;
        border: 1px solid transparent;
        transition: all 0.2s ease;
      }
      .profile-modal__close:hover {
        color: #475569;
        border-color: #e2e8f0;
        background: #f8fafc;
      }
      .profile-modal__tabs {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px;
        margin: 18px 26px 8px;
        padding: 6px;
        background: #f1f5f9;
        border-radius: 14px;
      }
      .profile-tab {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        border: none;
        border-radius: 10px;
        padding: 10px 12px;
        font-weight: 600;
        font-size: 13px;
        color: #64748b;
        background: transparent;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .profile-tab.is-active {
        background: #ffffff;
        color: #4f46e5;
        box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
      }
      .profile-tab__icon {
        width: 18px;
        height: 18px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .profile-tab__icon svg {
        width: 18px;
        height: 18px;
      }
      .profile-modal__body {
        padding: 18px 26px 20px;
      }
      .profile-tab-panel {
        display: none;
      }
      .profile-tab-panel.is-active {
        display: block;
      }
      .profile-form__grid {
        gap: 16px;
      }
      .profile-field label {
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.05em;
        color: #94a3b8;
        text-transform: uppercase;
        margin-bottom: 6px;
        pointer-events: none;
      }
      .profile-input-wrap {
        position: relative;
        display: flex;
        align-items: center;
        background: #f8fafc;
        border: 1px solid #eef2f7;
        border-radius: 12px;
        height: 44px;
        padding: 0 14px 0 40px;
      }
      .profile-input-wrap--secure:focus-within {
        border-color: #0f172a;
        background: #ffffff;
      }
      .profile-input-icon {
        position: absolute;
        left: 14px;
        width: 18px;
        height: 18px;
        color: #94a3b8;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .profile-input-icon svg {
        width: 18px;
        height: 18px;
      }
      .profile-input {
        border: none !important;
        background: transparent !important;
        box-shadow: none !important;
        padding: 0;
        height: 100%;
        width: 100%;
        font-size: 14px;
        color: #0f172a;
        outline: none;
      }
      .profile-input:focus {
        outline: none;
        box-shadow: none;
      }
      .profile-input-wrap:focus-within {
        border-color: #4f46e5;
        background: #ffffff;
      }
      .profile-input:-webkit-autofill,
      .profile-input:-webkit-autofill:hover,
      .profile-input:-webkit-autofill:focus {
        -webkit-text-fill-color: #0f172a;
        -webkit-box-shadow: 0 0 0 1000px transparent inset;
        transition: background-color 9999s ease-out;
      }
      .profile-field--full {
        grid-column: span 2;
      }
      .profile-form__notice {
        display: none;
        margin-top: 12px;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid rgba(239, 68, 68, 0.25);
        background: rgba(239, 68, 68, 0.08);
        color: #b91c1c;
        font-size: 12px;
        font-weight: 600;
      }
      .profile-modal__footer {
        display: flex;
        gap: 12px;
        margin-top: 18px;
      }
      .profile-btn {
        flex: 1;
        height: 42px;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        background: #ffffff;
        color: #475569;
        font-weight: 600;
        font-size: 13px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      .profile-btn.primary {
        border: 1px solid #4f46e5;
        background: #4f46e5;
        color: #ffffff;
      }
      .profile-btn.ghost {
        background: #ffffff;
        color: #475569;
      }
      .profile-btn__icon {
        width: 16px;
        height: 16px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .profile-btn__icon svg {
        width: 16px;
        height: 16px;
      }
      @media (max-width: 520px) {
        .profile-modal__card {
          width: calc(100% - 32px);
        }
        .profile-form__grid {
          grid-template-columns: 1fr;
        }
        .profile-field--full {
          grid-column: span 1;
        }
      }
      @media (max-width: 900px) {
        .left-menu {
          width: 72px;
          flex-basis: 72px;
          padding: 14px 0 18px;
        }
        .left-menu-logo,
        .left-menu-title,
        .left-menu-footer,
        .left-menu-label {
          display: none;
        }
        .left-menu-item {
          justify-content: center;
          padding: 12px 0;
        }
        .left-menu-item.active::after {
          display: none;
        }
        .tabs-bar {
          padding: 10px 14px;
        }
      }
      @media (max-width: 480px) {
        .tabs-actions {
          gap: 6px;
        }
        .tabs {
          gap: 6px;
        }
      }
      /* ===== Контейнер содержимого вкладки ===== */
      .tab-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        min-width: 0;
      }
      /* ===== Тулбар вкладки ===== */
      .tab-toolbar {
        padding: 14px 18px;
        border-bottom: none;
        background-color: transparent;
        display: flex;
        align-items: center;
        gap: 12px;
        min-height: 56px;
        box-sizing: border-box;
        flex-wrap: nowrap;
        overflow-x: auto;
        overflow-y: hidden;
        box-shadow: none;
        backdrop-filter: none;
      }
      .tab-toolbar > * {
        flex: 0 0 auto;
      }
      .tab-toolbar:empty {
        display: none;
      }
      .tab-toolbar-title {
        font-weight: 800;
        margin-right: 12px;
        color: var(--text-main);
        font-size: 18px;
      }
      /* ===== Кнопки в тулбаре ===== */
      .toolbar-button {
        padding: 12px 16px;
        border-radius: 12px;
        border: none;
        background-color: var(--bg-surface);
        color: var(--text-main);
        cursor: pointer;
        font-size: 14px;
        font-weight: 700;
        transition: background-color 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, transform 0.12s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        min-height: 40px;
      }
      .toolbar-button:hover {
        background-color: #f1f5f9;
        box-shadow: var(--premium-shadow);
        transform: translateY(-1px);
        border-color: #94a3b8;
      }
      .toolbar-button:active {
        box-shadow: inset 0 1px 2px 0 rgba(12, 34, 70, 0.12);
        transform: translateY(0);
      }
      /* ===== Сабтулбар (фильтры, поиск) ===== */
      .subtoolbar {
        padding: 10px 18px;
        border-bottom: none;
        background-color: transparent;
        display: flex;
        align-items: center;
        gap: 14px;
        font-size: 14px;
        min-height: 48px;
        box-sizing: border-box;
        flex-wrap: nowrap;
        overflow-x: auto;
        overflow-y: hidden;
      }
      .subtoolbar > * {
        flex: 0 0 auto;
      }
      .subtoolbar:empty {
        display: none;
      }
      .panel-loading {
        padding: 32px;
        display: inline-flex;
        align-items: center;
        gap: 12px;
        color: var(--on-surface-color);
        font-size: var(--font-size-large);
        animation: fadeIn 0.18s ease;
      }
      .panel-loading .spinner {
        width: 20px;
        height: 20px;
        border: 3px solid #e8eaed;
        border-top-color: #4285f4;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }
      .subtoolbar select,
      .subtoolbar input[type="text"],
      .subtoolbar input[type="search"] {
        font-size: var(--font-size-medium);
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--border-radius);
        border: none;
        background-color: #f8fafc;
        color: var(--text-main);
        box-sizing: border-box;
        box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08), inset 0 1px 2px rgba(255, 255, 255, 0.7);
        transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
      }
        .subtoolbar select:focus,
        .subtoolbar input[type="text"]:focus,
        .subtoolbar input[type="search"]:focus {
          outline: none;
          border-color: var(--primary-color);
          box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
          background-color: #ffffff;
        }
        .date-input-wrapper {
          position: relative;
          display: inline-flex;
          align-items: center;
        }
      .date-input {
        padding: 8px 12px 8px 40px;
        border-radius: 999px;
        border: none;
        background-color: #f8fafc;
        min-width: 160px;
        box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08), inset 0 1px 2px rgba(255, 255, 255, 0.7);
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }
        .date-input:focus {
          outline: none;
          border-color: var(--primary-color);
          box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
          background-color: #ffffff;
        }
        .date-input-icon {
          position: absolute;
          left: 12px;
          width: 18px;
          height: 18px;
          pointer-events: none;
          color: var(--primary-color);
          opacity: 1;
        }
      /* ===== Область данных (таблица, форма) ===== */
      .data-area {
        flex: 1;
        overflow: auto;
        padding: 18px 22px 24px;
        background-color: transparent;
        border-radius: 0;
        box-shadow: none;
        display: flex;
        flex-direction: column;
      }
      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
        gap: var(--spacing-md);
      }
      .card {
        background: var(--glass-bg);
        border: none;
        border-radius: var(--border-radius);
        box-shadow: var(--glass-shadow);
        backdrop-filter: blur(24px);
        padding: var(--spacing-md);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
        transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
      }
      .card:hover {
        transform: translateY(-4px);
        box-shadow: var(--premium-shadow);
      }
      .card-title {
        font-weight: var(--font-weight-bold);
        font-size: var(--font-size-large);
        color: var(--text-main);
      }
      .card-subtitle {
        color: var(--text-muted);
        font-size: var(--font-size-small);
      }
      .table-wrapper {
        overflow: auto;
        border: none;
        border-radius: var(--border-radius);
      }
      .data-table {
        width: 100%;
        border-collapse: collapse;
      }
      .data-table th, .data-table td {
        border: none;
        padding: 6px 8px;
        text-align: center;
        background: #fff;
      }
      .data-table input {
        width: 100%;
        border: none;
        outline: none;
        background: transparent;
        text-align: center;
      }
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: var(--spacing-md);
      }
      .form-grid label {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: var(--font-size-small);
        color: var(--on-surface-secondary-color);
      }
      .form-grid input, .form-grid select {
        padding: 10px 12px;
        border-radius: var(--border-radius);
        border: 1px solid var(--divider-color);
        background: #f8fafc;
        color: var(--text-main);
        box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.06);
      }
      .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: var(--spacing-sm);
      }
      /* ===== Главная ===== */
      .shell-breadcrumbs {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .breadcrumb-pill {
        padding: 10px 14px;
        border-radius: 12px;
        border: none;
        background: var(--glass-bg);
        color: var(--text-muted);
        font-weight: 700;
        box-shadow: var(--glass-shadow);
        backdrop-filter: blur(18px);
      }
      .breadcrumb-pill.active {
        background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
        color: var(--text-main);
      }
      .home-period-picker {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 12px;
        background: var(--glass-bg);
        border: none;
        box-shadow: var(--glass-shadow);
        backdrop-filter: blur(18px);
      }
      .home-period-label {
        color: var(--text-muted);
        font-weight: 600;
      }
      .date-chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
        border-radius: 12px;
        border: none;
        background: #f1f5f9;
        min-width: 150px;
        color: var(--text-main);
        font-weight: 700;
        box-shadow: 0 10px 22px rgba(15, 23, 42, 0.08), inset 0 1px 2px rgba(255, 255, 255, 0.7);
      }
      .date-chip input {
        border: none;
        background: transparent;
        width: 100%;
        font-weight: 700;
        color: var(--text-main);
      }
      .date-chip input:focus {
        outline: none;
      }
      .home-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 18px;
        padding: 4px;
        animation: fadeIn 0.2s ease;
      }
      .home-card {
        background: var(--glass-bg);
        border: none;
        border-radius: 16px;
        box-shadow: var(--glass-shadow);
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        height: 520px;
        overflow: hidden;
        backdrop-filter: blur(24px);
        transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
      }
      .home-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--premium-shadow);
      }
      .home-plan-card {
        height: 520px;
      }
      .home-plan-card .home-list {
        overflow-y: auto;
      }
      .home-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 800;
        font-size: 18px;
        color: var(--text-main);
      }
      .home-card-subtitle {
        color: var(--text-muted);
        font-weight: 600;
        font-size: 13px;
        margin-left: auto;
      }
      .home-stats {
        display: grid;
        grid-template-columns: repeat(2, minmax(120px, 1fr));
        gap: 12px;
      }
      .home-stat {
        border-radius: 14px;
        padding: 14px;
        border: none;
        background: #f8fafc;
        box-shadow: inset 0 1px 0 rgba(255,255,255,0.8);
      }
      .home-stat:nth-child(2) {
        background: #f8fafc;
      }
      .home-stat-label {
        color: var(--text-muted);
        font-size: 13px;
        margin-bottom: 4px;
        font-weight: 600;
      }
      .home-stat-value {
        font-size: 28px;
        font-weight: 800;
        color: var(--text-main);
      }
      .home-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .btn-primary {
        background: linear-gradient(180deg, #2f80ff 0%, #1e6bff 100%);
        color: #ffffff;
        border-color: #1e6bff;
        box-shadow: 0 12px 24px rgba(59, 130, 246, 0.3);
      }
      .btn-primary:hover {
        background: linear-gradient(180deg, #1e6bff 0%, #1b64f0 100%);
        color: #ffffff;
      }
      .btn-ghost {
        background: rgba(226, 232, 240, 0.6);
        color: #475569;
        border-color: #cbd5e1;
      }
      .toolbar-button.btn-ghost:hover {
        background: #e2e8f0;
        color: var(--text-main);
        border-color: #94a3b8;
      }
      .home-page-heading {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 14px;
        padding: 0 4px;
      }
      .home-page-title {
        font-size: 22px;
        font-weight: 800;
        color: var(--text-main);
      }
      .home-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
        flex: 1;
        min-height: 0;
        overflow: auto;
        padding-right: 4px;
      }
      .home-list-item {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 12px;
        padding: 12px 14px;
        border: none;
        border-radius: 14px;
        background: var(--bg-card);
        color: var(--text-main);
        font-weight: 700;
      }
      .home-list-meta {
        color: var(--text-muted);
        font-size: 12px;
        font-weight: 600;
        margin-top: 4px;
      }
      .home-empty {
        color: #94a3b8;
        font-size: 14px;
        padding: 12px 0;
        text-align: center;
      }
      .home-plan-day {
        border: none;
        border-radius: 14px;
        overflow: hidden;
        background: #f8fafc;
        box-shadow: inset 0 1px 0 rgba(255,255,255,0.8);
        flex-shrink: 0;
      }
      .home-plan-day-title {
        padding: 12px 14px;
        font-weight: 800;
        background: #faf5ff;
        color: #7c3aed;
        border-bottom: none;
      }
      .home-plan-day-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 12px;
      }
      .home-plan-pill {
        display: grid;
        grid-template-columns: minmax(0, 1fr) 140px;
        column-gap: 14px;
        padding: 12px 14px;
        background: var(--bg-card);
        border: none;
        border-radius: 14px;
        box-shadow: var(--glass-shadow);
        cursor: pointer;
        transition: transform 0.14s ease, box-shadow 0.14s ease, background-color 0.14s ease;
        align-items: center;
      }
      .home-plan-pill:hover {
        transform: translateY(-2px);
        box-shadow: var(--premium-shadow);
        background: #f8fafc;
      }
      .home-plan-left {
        display: flex;
        flex-direction: column;
        gap: 6px;
        min-width: 0;
      }
      .home-plan-org {
        font-weight: 700;
        color: var(--text-main);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .home-plan-item {
        color: var(--primary-color);
        font-weight: 700;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .home-plan-meta {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 8px;
        white-space: nowrap;
        width: 140px;
        flex-shrink: 0;
      }
      .app-root.sidebar-collapsed .home-plan-pill {
        grid-template-columns: minmax(0, 1fr) 120px;
      }
      .app-root.sidebar-collapsed .home-plan-meta {
        width: 120px;
      }
      .home-plan-qty {
        background: #e2e8f0;
        color: var(--text-main);
        padding: 6px 12px;
        border-radius: 999px;
        font-weight: 800;
        justify-self: flex-start;
      }
      .home-plan-link {
        color: var(--text-main);
        font-size: 12px;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        text-align: right;
      }
      .home-drive-list {
        max-height: none;
        min-height: 140px;
      }
      .home-drive-row {
        padding: 12px 14px;
        border: none;
        border-radius: 12px;
        background: var(--bg-card);
        display: flex;
        justify-content: space-between;
        gap: 12px;
        cursor: pointer;
        transition: background-color 0.12s ease, box-shadow 0.12s ease, transform 0.12s ease;
      }
      .home-drive-row:hover {
        background: #f8fafc;
        box-shadow: var(--glass-shadow);
        transform: translateY(-1px);
      }
      .home-drive-name {
        font-weight: 700;
        color: var(--text-main);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .home-drive-meta {
        color: var(--text-muted);
        font-size: 12px;
      }
      .home-drive-search {
        display: flex;
        justify-content: center;
        padding: 0 8px 8px;
      }
      .home-drive-search input {
        width: 100%;
        max-width: 520px;
        padding: 12px 14px;
        border: none;
        border-radius: 12px;
        box-shadow: 0 12px 26px rgba(15, 23, 42, 0.08), inset 0 1px 2px rgba(255, 255, 255, 0.7);
        background: #f8fafc;
        color: var(--text-main);
      }
      .home-drive-search input::placeholder {
        color: #94a3b8;
      }
      .home-upload-overlay {
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.2);
        display: none;
        align-items: flex-start;
        justify-content: center;
        z-index: 20000;
        backdrop-filter: blur(2px);
        overflow: auto;
        padding: 24px 12px;
      }
      .home-upload-window {
        width: min(540px, 95vw);
        background: var(--bg-surface);
        border-radius: 16px;
        box-shadow: var(--shadow-elevation-8);
        overflow: auto;
        animation: fadeIn 0.18s ease;
        max-height: 90vh;
      }
      .home-upload-header {
        padding: 16px 18px;
        font-weight: 800;
        font-size: 18px;
        border-bottom: 1px solid var(--border-color);
        position: sticky;
        top: 0;
        background: var(--bg-surface);
      }
      .home-upload-body {
        padding: 16px 18px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        overflow: auto;
      }
      .home-upload-actions {
        padding: 12px 18px;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }
      .home-dropzone {
        border: 2px dashed #cbd5e1;
        border-radius: 14px;
        padding: 20px;
        text-align: center;
        color: var(--text-muted);
        background: #f8fafc;
        cursor: pointer;
        transition: border-color 0.14s ease, background-color 0.14s ease, color 0.14s ease;
        font-weight: 700;
      }
      .home-dropzone.dragover {
        border-color: #1e6bff;
        background: #eff6ff;
        color: var(--primary-color);
      }
      .home-dropzone.uploading {
        opacity: 0.7;
        pointer-events: none;
      }
      .home-upload-hint {
        color: var(--text-muted);
        font-size: 12px;
      }
      .home-period-picker input {
        min-width: 120px;
      }
      /* ===== Таблицы ===== */
      table.data-table {
        border-collapse: collapse;
        width: 100%;
        font-size: var(--font-size-medium);
        table-layout: fixed;
        background-color: var(--background-color);
        border: 1px solid var(--divider-color);
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow-elevation-1);
      }
      table.data-table th,
      table.data-table td {
        border-right: 1px solid var(--divider-color);
        border-bottom: 1px solid var(--divider-color);
        padding: var(--spacing-sm) var(--spacing-sm);
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        height: 40px; /* Увеличиваем высоту ячейки */
        line-height: 24px;
        vertical-align: middle;
      }
      table.data-table th:last-child,
      table.data-table td:last-child {
        border-right: none;
      }
      table.data-table tr:last-child td {
        border-bottom: none;
      }
      table.data-table th {
        background-color: #f8fafc; /* Цвет заголовка таблицы */
        position: sticky;
        top: 0;
        z-index: 10;
        font-weight: var(--font-weight-medium);
        color: var(--on-surface-color);
        cursor: pointer;
        user-select: none;
        transition: background-color 0.2s ease;
      }
      table.data-table th:hover {
        background-color: #e2e8f0;
      }
      table.data-table tr:nth-child(even) td {
        background-color: #f8fafc; /* Цвет чётных строк */
      }
      .data-row {
        transition: background-color 0.18s ease, box-shadow 0.18s ease;
        cursor: pointer;
      }
      .data-row:not(.data-row-selected):hover td {
        background-color: #eff6ff !important; /* Цвет ховера строки */
        box-shadow: inset 0 1px 0 rgba(15, 23, 42, 0.05);
      }
      .data-row-selected td {
        background-color: #dbeafe !important; /* Цвет выбранной строки */
        box-shadow: inset 0 1px 0 rgba(15, 23, 42, 0.08);
      }
      .data-row.data-row-selected:hover td {
        background-color: #dbeafe !important;
      }
      /* ===== Ресайзер колонок ===== */
      .col-resizer {
        position: absolute;
        top: 0;
        right: 0;
        width: 5px;
        height: 100%;
        cursor: col-resize;
        user-select: none;
      }
      /* ===== Нижняя панель ===== */
      .bottom-panel {
        display: none;
        border-top: none;
        padding: 0;
        height: 0;
      }
      .chart-block {
        flex: 1;
        border: 1px solid var(--divider-color);
        background-color: var(--background-color);
        padding: var(--spacing-sm);
        box-sizing: border-box;
        font-size: var(--font-size-small);
        border-radius: var(--border-radius);
        display: flex;
        flex-direction: column;
      }
      .chart-title {
        font-weight: var(--font-weight-medium);
        margin-bottom: var(--spacing-xs);
        color: var(--on-surface-secondary-color);
      }
      /* ===== Контекстное меню ===== */
      .row-context-menu {
        position: fixed;
        z-index: 10000;
        background-color: var(--background-color);
        border: 1px solid var(--divider-color);
        box-shadow: var(--shadow-elevation-4);
        min-width: 180px;
        font-size: var(--font-size-medium);
        border-radius: var(--border-radius);
        overflow: hidden;
        max-height: 300px; /* Ограничиваем высоту */
        overflow-y: auto;
      }
      .row-context-item {
        padding: var(--spacing-sm) var(--spacing-md);
        cursor: pointer;
        transition: background-color 0.2s ease;
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
      }
      .row-context-item:hover {
        background-color: #f1f3f4;
      }
      .row-context-item-danger {
        color: var(--error-color);
      }
      .row-context-item-danger:hover {
        background-color: #fce8e6;
      }
      /* ===== Модальные диалоги приложения ===== */
      .dialog-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 20000;
        backdrop-filter: blur(2px); /* Лёгкий блюр фона */
      }
      .dialog-window {
        background-color: var(--background-color);
        border-radius: var(--border-radius);
        padding: var(--spacing-lg);
        box-shadow: var(--shadow-elevation-8);
        min-width: 320px;
        max-width: 500px;
        box-sizing: border-box;
        max-height: 90vh;
        overflow-y: auto;
      }
      .dialog-title {
        font-weight: var(--font-weight-bold);
        font-size: var(--font-size-large);
        margin-bottom: var(--spacing-sm);
        color: var(--on-surface-color);
        padding-bottom: var(--spacing-sm);
        border-bottom: 1px solid var(--divider-color);
      }
      .dialog-message {
        font-size: var(--font-size-medium);
        line-height: 1.5;
        margin-bottom: var(--spacing-lg);
        color: var(--on-surface-secondary-color);
        white-space: pre-wrap; /* Для переноса строк в сообщении */
      }
      .dialog-buttons {
        display: flex;
        justify-content: flex-end;
        gap: var(--spacing-md);
        margin-top: var(--spacing-md);
      }
      .dialog-btn {
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--border-radius);
        border: 1px solid var(--divider-color);
        background-color: var(--background-color);
        color: var(--on-surface-color);
        cursor: pointer;
        font-size: var(--font-size-medium);
        font-weight: var(--font-weight-medium);
        min-width: 70px;
        transition: background-color 0.2s ease, box-shadow 0.2s ease;
      }
      .dialog-btn:hover {
        background-color: #f1f3f4;
      }
      .dialog-btn-primary {
        border-color: var(--primary-dark);
        background-color: var(--primary-color);
        color: white;
      }
      .dialog-btn-primary:hover {
        background-color: var(--primary-dark);
      }

      /* ===== Комбобокс (выпадающий список) ===== */
      .combo-wrapper {
        position: relative;
        display: inline-block;
        width: 100%;
      }
      .split-field { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
      .combo-input {
        width: 100%;
        box-sizing: border-box;
        padding: var(--spacing-xs) var(--spacing-sm);
        font-size: var(--font-size-medium);
        border-radius: var(--border-radius);
        border: 1px solid var(--divider-color);
        background-color: var(--background-color);
        color: var(--on-surface-color);
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }
      .combo-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
      }
      .combo-list {
        position: absolute;
        left: 0;
        right: 0;
        top: 100%;
        margin-top: var(--spacing-xs);
        background-color: var(--background-color);
        border: 1px solid var(--divider-color);
        box-shadow: var(--shadow-elevation-4);
        border-radius: var(--border-radius);
        max-height: 200px;
        overflow-y: auto;
        font-size: var(--font-size-medium);
        z-index: 15000;
        display: none;
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .combo-item {
        padding: var(--spacing-sm) var(--spacing-sm);
        cursor: pointer;
        transition: background-color 0.2s ease;
        border-bottom: 1px solid var(--divider-color);
      }
      .combo-item:last-child {
          border-bottom: none;
      }
      .combo-item:hover {
        background-color: #f1f3f4;
      }
      /* ===== Стили для красивых чекбоксов (повторяем из предыдущего обновления) ===== */
      input[type="checkbox"] {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border: 2px solid var(--divider-color);
        border-radius: 3px;
        position: relative;
        cursor: pointer;
        background-color: var(--background-color);
        transition: all 0.12s ease;
      }
      input[type="checkbox"]:checked {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }
      input[type="checkbox"]:checked::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 5px;
        width: 4px;
        height: 8px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
        opacity: 1;
      }
      input[type="checkbox"]:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.3);
      }
      /* ===== Стили для красивых радио-кнопок (на будущее) ===== */
      input[type="radio"] {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border: 2px solid var(--divider-color);
        border-radius: 50%;
        position: relative;
        cursor: pointer;
        background-color: var(--background-color);
        transition: all 0.12s ease;
      }
      input[type="radio"]:checked {
        border-color: var(--primary-color);
      }
      input[type="radio"]:checked::after {
        content: '';
        position: absolute;
        top: 3px;
        left: 3px;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background-color: var(--primary-color);
      }
      input[type="radio"]:focus {
        outline: none;
        box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.3);
      }
      /* ===== Стили для красивых селектов (на будущее) ===== */
      select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--border-radius);
        border: 1px solid var(--divider-color);
        background-color: var(--background-color);
        color: var(--on-surface-color);
        font-size: var(--font-size-medium);
        cursor: pointer;
        background-image: url("image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235f6368' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right var(--spacing-xs) center;
        background-size: 16px;
        padding-right: 28px;
      }
      select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
      }
      /* ===== Стили для красивых полей ввода ===== */
      input[type="text"],
      input[type="number"],
      input[type="search"],
      input[type="date"],
      input[type="time"],
      input[type="email"],
      input[type="password"],
      textarea {
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--border-radius);
        border: 1px solid var(--divider-color);
        background-color: var(--background-color);
        color: var(--on-surface-color);
        font-size: var(--font-size-medium);
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
        box-sizing: border-box;
      }
      input[type="text"]:focus,
      input[type="number"]:focus,
      input[type="search"]:focus,
      input[type="date"]:focus,
      input[type="time"]:focus,
      input[type="email"]:focus,
      input[type="password"]:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
      }
      textarea {
        resize: vertical;
        min-height: 40px;
        max-height: 200px;
      }
      /* ===== Стили для кнопок (повторяем и расширяем) ===== */
      button, .button-like {
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--border-radius);
        border: 1px solid transparent;
        font-size: var(--font-size-medium);
        font-weight: var(--font-weight-medium);
        cursor: pointer;
        transition: background-color 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-xs);
        min-height: 32px;
        text-align: center;
        box-sizing: border-box;
      }
      button.primary, .button-like.primary {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-dark);
      }
      button.primary:hover, .button-like.primary:hover {
        background-color: var(--primary-dark);
        box-shadow: var(--shadow-elevation-2);
      }
      button.secondary, .button-like.secondary {
        background-color: #f1f3f4;
        color: var(--on-surface-color);
        border-color: var(--divider-color);
      }
      button.secondary:hover, .button-like.secondary:hover {
        background-color: #e8eaed;
        box-shadow: var(--shadow-elevation-1);
      }
      button.outlined, .button-like.outlined {
        background-color: transparent;
        color: var(--primary-color);
        border-color: var(--primary-color);
      }
      button.outlined:hover, .button-like.outlined:hover {
        background-color: rgba(66, 133, 244, 0.1);
      }
      button.text, .button-like.text {
        background-color: transparent;
        color: var(--primary-color);
        border-color: transparent;
      }
      button.text:hover, .button-like.text:hover {
        background-color: rgba(66, 133, 244, 0.1);
      }
      button:disabled, .button-like:disabled {
        background-color: #f1f3f4;
        color: var(--on-surface-secondary-color);
        border-color: var(--divider-color);
        cursor: not-allowed;
      }
      /* ===== Стили для форм (повторяем из ui_contracts и ui_warehouse) ===== */
      .form-container {
        padding: var(--spacing-md);
        font-family: var(--font-family);
        background-color: var(--background-color);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-elevation-1);
        max-width: 800px;
        margin: 0 auto;
      }
      .form-container h3 {
        margin-top: 0;
        margin-bottom: var(--spacing-md);
        color: var(--on-surface-color);
        font-weight: var(--font-weight-bold);
        font-size: var(--font-size-large);
      }
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-md);
      }
      .form-field {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-xs);
      }
      .form-field label {
        font-size: var(--font-size-medium);
        color: var(--on-surface-color);
        font-weight: var(--font-weight-medium);
      }
      .form-field .combo-wrapper {
        position: relative;
      }
      .form-actions {
        display: flex;
        gap: var(--spacing-md);
        margin-top: var(--spacing-lg);
        justify-content: flex-end;
      }
      /* ===== Стили для календаря ===== */
      .calendar-popup {
        position: absolute;
        z-index: 10000;
        background-color: var(--background-color);
        border: 1px solid var(--divider-color);
        box-shadow: var(--shadow-elevation-4);
        border-radius: var(--border-radius);
        padding: var(--spacing-sm);
        font-size: var(--font-size-medium);
        min-width: 320px;
        animation: fadeInUp 0.2s ease-out;
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      @keyframes gridMove {
        from { transform: perspective(900px) rotateX(55deg) translateY(120px); }
        to { transform: perspective(900px) rotateX(55deg) translateY(40px); }
      }
      @keyframes ringPulse {
        0%, 100% { transform: scale(1); opacity: 0.6; }
        50% { transform: scale(1.05); opacity: 0.9; }
      }
      @keyframes beamScan {
        0%, 100% { transform: translateY(-60px); opacity: 0.4; }
        50% { transform: translateY(60px); opacity: 1; }
      }
      @keyframes particleFloat {
        0%, 100% { transform: translateY(0); opacity: 0.4; }
        50% { transform: translateY(-12px); opacity: 1; }
      }
      @keyframes streamFill {
        0% { filter: brightness(0.7); transform: scaleX(0.5); transform-origin: left; }
        50% { filter: brightness(1.2); transform: scaleX(1); }
        100% { filter: brightness(0.7); transform: scaleX(0.6); transform-origin: right; }
      }
      @keyframes binaryStream {
        0% { transform: translateX(-20%); }
        100% { transform: translateX(20%); }
      }
      @keyframes eqBounce {
        0%, 100% { transform: scaleY(0.6); opacity: 0.6; }
        50% { transform: scaleY(1); opacity: 1; }
      }
      .calendar-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: var(--spacing-sm);
      }
      .calendar-nav {
        display: flex;
        gap: var(--spacing-xs);
      }
      .calendar-nav-btn {
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--border-radius);
        border: 1px solid var(--divider-color);
        background-color: var(--background-color);
        cursor: pointer;
        transition: background-color 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        font-size: var(--font-size-large);
        line-height: 1;
      }
      .calendar-nav-btn:hover {
        background-color: #f1f3f4;
      }
      .calendar-month-year {
        font-weight: var(--font-weight-bold);
        color: var(--on-surface-color);
        font-size: var(--font-size-large);
      }
      .calendar-body {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: var(--spacing-xs);
        margin-bottom: var(--spacing-sm);
      }
      .calendar-day-name {
        font-size: var(--font-size-small);
        color: var(--on-surface-secondary-color);
        text-align: center;
        padding: var(--spacing-xs);
        font-weight: var(--font-weight-bold);
      }
      .calendar-day {
        padding: var(--spacing-xs);
        border-radius: var(--border-radius);
        text-align: center;
        cursor: pointer;
        transition: background-color 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 40px;
        font-size: var(--font-size-large);
        font-weight: var(--font-weight-medium);
      }
      .calendar-day:hover {
        background-color: #f1f3f4;
      }
      .calendar-day.today {
        background-color: var(--primary-light);
        color: var(--primary-dark);
        font-weight: var(--font-weight-bold);
      }
      .calendar-day.selected {
        background-color: var(--primary-color);
        color: white;
        font-weight: var(--font-weight-bold);
      }
      .calendar-day.disabled {
        color: var(--on-surface-secondary-color);
        opacity: 0.5;
        cursor: not-allowed;
      }
      .calendar-footer {
        display: flex;
        gap: var(--spacing-xs);
        justify-content: space-between;
        margin-top: var(--spacing-sm);
      }
      .calendar-footer-btn {
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--border-radius);
        border: 1px solid var(--divider-color);
        background-color: var(--background-color);
        cursor: pointer;
        transition: background-color 0.2s ease;
        font-size: var(--font-size-medium);
        line-height: 1;
      }
      .calendar-footer-btn:hover {
        background-color: #f1f3f4;
      }
      
      /* ===== Стили модального окна авторизации ===== */
      .auth-modal {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.25s ease;
        z-index: 30000;
        color: #f5f6ff;
        font-family: "Inter", sans-serif;
      }

      .auth-modal.active {
        opacity: 1;
        pointer-events: auto;
      }

      .auth-modal__overlay {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(14px);
      }

      .auth-modal__content {
        position: relative;
        width: min(448px, 92vw);
        max-height: min(680px, 92vh);
        padding: 32px;
        background: #111827;
        border-radius: 24px;
        border: 1px solid #334155;
        box-shadow: 0 24px 70px rgba(0, 0, 0, 0.55);
        z-index: 2;
        color: #f5f6ff;
        font-family: "Inter", sans-serif;
        overflow-x: hidden;
        overflow-y: auto;
      }

      .auth-modal__content::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        box-shadow: inset 0 0 24px rgba(90, 96, 160, 0.18);
        pointer-events: none;
      }

      .auth-modal__content::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        height: 6px;
        border-radius: 0 0 24px 24px;
        background: linear-gradient(90deg, rgba(99, 102, 241, 0), rgba(124, 58, 237, 0.9), rgba(99, 102, 241, 0));
      }

      .auth-modal__close {
        position: absolute;
        top: 16px;
        right: 16px;
        background: transparent;
        border: none;
        font-size: 20px;
        line-height: 1;
        color: rgba(148, 163, 184, 0.7);
        cursor: pointer;
        transition: color 0.2s ease;
      }

      .auth-modal__close:hover {
        color: #ffffff;
      }

      .auth-steps {
        overflow: hidden;
      }

      .auth-track {
        display: flex;
        width: 400%;
        transform: translateX(var(--auth-x, 0%));
        transition: transform 520ms cubic-bezier(0.2, 0.8, 0.2, 1);
        will-change: transform;
      }

      .auth-step {
        width: 100%;
        flex: 0 0 100%;
        text-align: center;
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      .auth-step.is-active {
        opacity: 1;
      }

      .auth-app-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background: linear-gradient(135deg, #4f46e5, #7c3aed);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        color: #fff;
        margin: 4px auto 16px;
        box-shadow: 0 12px 24px rgba(79, 70, 229, 0.35);
        font-size: 20px;
      }

      .auth-step h2 {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 8px;
        color: #f8fafc;
      }

      .auth-subtitle {
        color: #94a3b8;
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 24px;
      }

      .auth-form {
        display: grid;
        gap: 14px;
        text-align: left;
      }

      .auth-modal .auth-label {
        font-size: 11px;
        color: #94a3b8;
        letter-spacing: 1.2px;
        text-transform: uppercase;
        font-weight: 700;
        margin-left: 4px;
        display: block;
        margin-bottom: 8px;
      }

      .auth-modal .auth-input {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 14px;
        border-radius: 12px;
        background: #1e293b;
        border: 1px solid #334155;
        height: 48px;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }

      .auth-modal .auth-input input {
        flex: 1;
        border: none;
        background: transparent;
        color: #e8e9f5;
        font-size: 14px;
        outline: none;
      }

      .auth-modal .auth-input input::placeholder {
        color: rgba(255, 255, 255, 0.35);
      }

      .auth-modal .auth-input:focus-within {
        border-color: #6366f1;
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.25);
      }

      .auth-modal .auth-icon {
        width: 18px;
        height: 18px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: #9da1bf;
        font-size: 16px;
      }

      .auth-modal .auth-forgot {
        display: flex;
        justify-content: flex-end;
        margin-top: -2px;
        margin-bottom: 8px;
      }

      .auth-modal .auth-link {
        background: transparent;
        border: none;
        color: #818cf8;
        font-size: 12px;
        cursor: pointer;
        text-decoration: none;
        transition: color 0.2s ease;
      }

      .auth-modal .auth-link:hover {
        color: #a5b4fc;
      }

      .auth-modal .auth-submit {
        width: 100%;
        padding: 14px 16px;
        margin-top: 18px;
        height: 52px;
        border-radius: 12px;
        font-size: 14px;
      }

      .auth-modal .primary-btn {
        border: none;
        border-radius: 12px;
        padding: 14px 16px;
        background: #4f46e5;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 14px 30px rgba(79, 70, 229, 0.25);
        font-size: 14px;
      }

      .auth-modal .primary-btn:hover {
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.35);
      }

      .auth-modal .primary-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        box-shadow: none;
      }

      .auth-modal .auth-divider {
        display: flex;
        align-items: center;
        gap: 12px;
        color: #64748b;
        font-size: 11px;
        margin: 20px 0 16px;
      }

      .auth-modal .auth-divider::before,
      .auth-modal .auth-divider::after {
        content: "";
        flex: 1;
        height: 1px;
        background: #1f2937;
      }

      .auth-modal .telegram-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 16px;
        width: 100%;
        border-radius: 12px;
        background: rgba(42, 171, 238, 0.1);
        color: #7dd3fc;
        text-decoration: none;
        border: 1px solid rgba(42, 171, 238, 0.2);
        font-size: 13px;
        font-weight: 600;
        transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        height: 48px;
      }

      .auth-modal .telegram-btn:hover {
        background: #2aabee;
        color: #ffffff;
        border-color: #2aabee;
        text-decoration: none;
      }

      .auth-modal .telegram-btn .auth-icon {
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: #2aabee;
        color: #fff;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.2);
      }

      .auth-modal .auth-switch {
        margin-top: 14px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.45);
        text-align: center;
      }

      .auth-modal .auth-switch .auth-link {
        color: #818cf8;
      }

      .auth-modal .auth-switch .auth-link:hover {
        color: #a5b4fc;
      }

      .auth-modal .auth-error {
        margin: 8px 0 10px;
        padding: 8px 10px;
        border-radius: 10px;
        background: rgba(255, 98, 98, 0.12);
        border: 1px solid rgba(255, 98, 98, 0.3);
        color: #ffb4b4;
        font-size: 11px;
      }
    </style>
    <script>
      (function () {
        var manifest = {
          name: 'ПП',
          short_name: 'ПП',
          start_url: '.',
          display: 'standalone',
          background_color: '#ffffff',
          theme_color: '#1A73E8'
        };
        var blob = new Blob([JSON.stringify(manifest)], { type: 'application/manifest+json' });
        var url = URL.createObjectURL(blob);
        var link = document.createElement('link');
        link.rel = 'manifest';
        link.href = url;
        document.head.appendChild(link);

        if ('serviceWorker' in navigator) {
          var swCode = "self.addEventListener('install', e => self.skipWaiting());self.addEventListener('activate', e => self.clients.claim());self.addEventListener('fetch', () => {});";
          var swUrl = URL.createObjectURL(new Blob([swCode], { type: 'text/javascript' }));
          navigator.serviceWorker.register(swUrl).catch(function (err) {
            console.log('Service worker registration error', err);
          });
        }
      })();
    </script>
    <script>
      // Активация модального окна авторизации
      document.addEventListener('DOMContentLoaded', function() {
        const authModal = document.getElementById('authModal');
        if (authModal) {
          // Активируем модальное окно
          authModal.classList.add('active');
          authModal.setAttribute('aria-hidden', 'false');
          
          // Закрытие модального окна
          const closeButtons = authModal.querySelectorAll('[data-auth-close]');
          closeButtons.forEach(btn => {
            btn.addEventListener('click', function() {
              authModal.classList.remove('active');
              authModal.setAttribute('aria-hidden', 'true');
            });
          });
          
          // Закрытие по клику на оверлей
          const overlay = authModal.querySelector('.auth-modal__overlay');
          if (overlay) {
            overlay.addEventListener('click', function() {
              authModal.classList.remove('active');
              authModal.setAttribute('aria-hidden', 'true');
            });
          }
        }
      });
    </script>
    <script src="{{ url_for('static', filename='js/backend.js') }}"></script>
</head>
  <body>
    <div id="appLoadingOverlay" class="app-loading-overlay">
      <div class="app-loading-bg"></div>
      <div class="app-loading-glow" aria-hidden="true"></div>
      <div class="app-loading-center">
        <svg class="app-loading-logo" viewBox="0 0 200 140" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="liquidMetal" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#9ca3af"/>
              <stop offset="50%" stop-color="#f8fafc"/>
              <stop offset="100%" stop-color="#9ca3af"/>
            </linearGradient>
          </defs>
          <path class="app-loading-p-left" d="M40 110 V30 H70 V110 M70 30 H40"/>
          <path class="app-loading-p-right" d="M130 110 V30 H160 V110 M160 30 H130"/>
          <path class="app-loading-smile" d="M50 120 C80 138, 120 138, 150 120"/>
        </svg>
        <div class="app-loading-title">ПРОСТЫЕ ПОСТАВКИ</div>
      </div>
      <div class="app-loading-line" aria-hidden="true"></div>
    </div>
    <div class="app-root">
      <div class="app-main">
        <!-- Левое меню -->
        <div class="left-menu sidebar">
          <div class="left-menu-logo">
            <div class="left-menu-badge left-menu-badge-smile" aria-hidden="true">
              <svg viewBox="0 0 48 48" aria-hidden="true">
                <path class="smile-eye" d="M10 34 V12 H18 V34 M18 12 H10" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <path class="smile-eye right" d="M30 34 V12 H38 V34 M38 12 H30" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <path class="smile-smile" d="M12 36 C18 42, 30 42, 36 36" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
              </svg>
            </div>
            <div class="left-menu-logo-text">
              <div class="title">ПростыеПоставки</div>
            </div>
          </div>
          <div class="left-menu-title">НАВИГАЦИЯ</div>
          <div class="left-menu-item" data-section="home">
            <span class="left-menu-icon">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 11.5L12 5l8 6.5"></path>
                <path d="M7.5 10.5V19h9v-8.5"></path>
              </svg>
            </span>
            <span class="left-menu-label">Главная</span>
          </div>
          <div class="left-menu-item" data-section="contracts">
            <span class="left-menu-icon">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <rect x="5" y="4" width="14" height="16" rx="3"></rect>
                <path d="M8 9h8"></path>
                <path d="M8 13h5"></path>
              </svg>
            </span>
            <span class="left-menu-label">Реестр контрактов</span>
          </div>
          <div class="left-menu-item" data-section="warehouse">
            <span class="left-menu-icon">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M3 9l9-4 9 4"></path>
                <path d="M5 9v9h14V9"></path>
                <path d="M9 18v-6h6v6"></path>
              </svg>
            </span>
            <span class="left-menu-label">Склад</span>
          </div>
          <div class="left-menu-item" data-section="analytics">
            <span class="left-menu-icon">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M5 19V9"></path>
                <path d="M12 19V5"></path>
                <path d="M19 19v-7"></path>
              </svg>
            </span>
            <span class="left-menu-label">Аналитика</span>
          </div>
          <div class="left-menu-item" data-section="commercials">
            <span class="left-menu-icon">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <rect x="4" y="7" width="16" height="12" rx="3"></rect>
                <path d="M8 7V5a4 4 0 0 1 8 0v2"></path>
                <path d="M4 12h16"></path>
              </svg>
            </span>
            <span class="left-menu-label">Коммерческие</span>
          </div>
          <div class="left-menu-item" data-section="pricelist">
            <span class="left-menu-icon">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M7 4h9a3 3 0 0 1 3 3v13H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3z"></path>
                <path d="M9 9h6"></path>
                <path d="M9 13h6"></path>
                <path d="M9 17h4"></path>
              </svg>
            </span>
            <span class="left-menu-label">Прайс-лист</span>
          </div>
          <div class="left-menu-footer sidebar-footer">
            <button type="button" class="left-menu-archive-btn" id="downloadArchiveBtn" aria-label="Экспорт XLS" title="Экспорт XLS">
              <span class="left-menu-archive-icon" aria-hidden="true">
                <svg viewBox="0 0 20 20">
                  <path d="M5 3h6l4 4v10H5z" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
                  <path d="M11 3v4h4" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/>
                  <path d="M7 11h6M7 14h4" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                </svg>
              </span>
              <span>Экспорт XLS</span>
            </button>
            <div class="left-menu-theme-row">
              <div class="left-menu-theme-info">
                <span class="left-menu-theme-icon" aria-hidden="true">
                  <svg viewBox="0 0 20 20">
                    <circle cx="10" cy="10" r="3.5" fill="none" stroke="currentColor" stroke-width="1.4"/>
                    <path d="M10 1.8v2.2M10 16v2.2M3.2 10H1M19 10h-2.2M4.2 4.2l1.6 1.6M14.2 14.2l1.6 1.6M15.8 4.2l-1.6 1.6M5.8 14.2l-1.6 1.6" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                  </svg>
                </span>
                <span class="left-menu-theme-label">Светлая тема</span>
              </div>
              <label class="ui-switch">
                <input type="checkbox" id="themeToggle" aria-label="Светлая тема">
                <span class="ui-switch__track"></span>
              </label>
            </div>
          </div>
        </div>
        <!-- Правая часть: вкладки + содержимое -->
        <div class="workspace">
          <div class="tabs-bar topnav">
            <button type="button" id="toggleSidebarBtn" class="sidebar-toggle-btn" aria-label="Скрыть боковую панель"></button>
            <div id="tabs" class="tabs"></div>
            <div class="tabs-actions">
              <button type="button" class="tabs-action-btn" aria-label="Уведомления" title="Уведомления">
                <svg viewBox="0 0 20 20" aria-hidden="true">
                  <path d="M10 3a4.5 4.5 0 0 0-4.5 4.5v2.2l-.9 2.1c-.2.6.2 1.2.8 1.2h9.2c.6 0 1-.6.8-1.2l-.9-2.1V7.5A4.5 4.5 0 0 0 10 3z" fill="none" stroke="currentColor" stroke-width="1.4"/>
                  <path d="M8.3 15.5a2 2 0 0 0 3.4 0" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                </svg>
              </button>
              <div class="profile-menu" data-current-user-id="{{ current_user.id }}">
                <button type="button" class="tabs-avatar" id="profileMenuToggle" aria-label="Профиль" aria-expanded="false">АД</button>
                <div class="profile-dropdown" id="profileMenu" aria-hidden="true">
                  <div class="profile-dropdown__header">
                    <div class="profile-dropdown__name">Администратор</div>
                    <div class="profile-dropdown__role">Госзакупки (Медицина)</div>
                  </div>
                  <div class="profile-dropdown__divider"></div>
                  <div class="profile-dropdown__accounts" id="profileAccounts" aria-hidden="true">
                    <div class="profile-dropdown__accounts-title">Аккаунты</div>
                    <div class="profile-dropdown__accounts-list" id="profileAccountsList"></div>
                    <div class="profile-dropdown__divider"></div>
                  </div>
                  <a class="profile-dropdown__item" href="/app/profile" id="profileSettingsBtn">
                    <span class="profile-dropdown__icon" aria-hidden="true">
                      <svg viewBox="0 0 20 20">
                        <path d="M11.5 3.5a2.5 2.5 0 1 0-3 0" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                        <path d="M4 10.5a6 6 0 0 1 12 0v1.2a1.8 1.8 0 0 0 .9 1.6l.1.1-.6 1.1-1.2-.4a2 2 0 0 1-1.1-.9l-.4-.6H6.3l-.4.6a2 2 0 0 1-1.1.9l-1.2.4-.6-1.1.1-.1a1.8 1.8 0 0 0 .9-1.6z" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </span>
                    <span>Настройки профиля</span>
                  </a>
                  <a class="profile-dropdown__item is-danger" href="/logout">
                    <span class="profile-dropdown__icon" aria-hidden="true">
                      <svg viewBox="0 0 20 20">
                        <path d="M12.5 4H5.5a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h7" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                        <path d="M12 6l4 4-4 4M16 10H8" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </span>
                    <span>Выйти из аккаунта</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
          <!-- Контейнер. В него JS будет "вставлять" набор: toolbar + subtoolbar + dataArea + bottom-panel для активной вкладки -->
          <div class="tab-content">
            <!-- Пусто: всё создаётся скриптом -->
          </div>
        </div>
      </div>
    </div>
    <!-- Модальный диалог приложения -->
    <div id="appDialogOverlay" class="dialog-overlay">
      <div class="dialog-window">
        <div id="appDialogTitle" class="dialog-title"></div>
        <div id="appDialogMessage" class="dialog-message"></div>
        <div id="appDialogButtons" class="dialog-buttons"></div>
      </div>
    </div>
    <div class="profile-modal" id="profileModal" aria-hidden="true">
      <div class="profile-modal__card" role="dialog" aria-modal="true" aria-labelledby="profileModalTitle">
        <div class="profile-modal__header">
          <div class="profile-modal__title" id="profileModalTitle">
            <svg viewBox="0 0 20 20" aria-hidden="true">
              <path d="M10 10.5a3.5 3.5 0 1 0-3.5-3.5A3.5 3.5 0 0 0 10 10.5Z" fill="none" stroke="currentColor" stroke-width="1.6"/>
              <path d="M4.5 16a5.5 5.5 0 0 1 11 0" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
            <span>Настройки</span>
          </div>
          <button class="profile-modal__close" type="button" id="profileModalClose" aria-label="Закрыть">&times;</button>
        </div>
        <div class="profile-modal__tabs" role="tablist">
          <button type="button" class="profile-tab is-active" data-tab="profile" role="tab" aria-selected="true">
            <span class="profile-tab__icon" aria-hidden="true">
              <svg viewBox="0 0 20 20">
                <path d="M10 10.5a3.5 3.5 0 1 0-3.5-3.5A3.5 3.5 0 0 0 10 10.5Z" fill="none" stroke="currentColor" stroke-width="1.6"/>
                <path d="M4.5 16a5.5 5.5 0 0 1 11 0" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
            </span>
            Профиль
          </button>
          <button type="button" class="profile-tab" data-tab="security" role="tab" aria-selected="false">
            <span class="profile-tab__icon" aria-hidden="true">
              <svg viewBox="0 0 20 20">
                <path d="M10 2.8l6 2.2v4.2c0 4-2.6 6.6-6 7.8-3.4-1.2-6-3.8-6-7.8V5l6-2.2z" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
                <path d="M10 8.2v4.2" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                <circle cx="10" cy="13.8" r="1" fill="currentColor"/>
              </svg>
            </span>
            Безопасность
          </button>
        </div>
        <div class="profile-modal__body">
          <div class="profile-tab-panel is-active" data-panel="profile">
            <form id="profileForm">
              <div class="profile-form__grid">
                <div class="profile-field">
                  <label for="profileFirstName">Имя</label>
                  <div class="profile-input-wrap">
                    <span class="profile-input-icon" aria-hidden="true">
                      <svg viewBox="0 0 20 20">
                        <path d="M10 10.5a3.5 3.5 0 1 0-3.5-3.5A3.5 3.5 0 0 0 10 10.5Z" fill="none" stroke="currentColor" stroke-width="1.6"/>
                        <path d="M4.5 16a5.5 5.5 0 0 1 11 0" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                      </svg>
                    </span>
                    <input class="profile-input" id="profileFirstName" name="first_name" type="text" placeholder="Администратор">
                  </div>
                </div>
                <div class="profile-field">
                  <label for="profileLastName">Фамилия</label>
                  <div class="profile-input-wrap">
                    <span class="profile-input-icon" aria-hidden="true">
                      <svg viewBox="0 0 20 20">
                        <path d="M10 10.5a3.5 3.5 0 1 0-3.5-3.5A3.5 3.5 0 0 0 10 10.5Z" fill="none" stroke="currentColor" stroke-width="1.6"/>
                        <path d="M4.5 16a5.5 5.5 0 0 1 11 0" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
                      </svg>
                    </span>
                    <input class="profile-input" id="profileLastName" name="last_name" type="text" placeholder="Иванов">
                  </div>
                </div>
                <div class="profile-field profile-field--full">
                  <label for="profileActivity">Сфера деятельности</label>
                  <div class="profile-input-wrap">
                    <span class="profile-input-icon" aria-hidden="true">
                      <svg viewBox="0 0 20 20">
                        <path d="M3 8h14M5 8v7m10-7v7M2.5 15.5h15" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                        <path d="M4 8l6-4 6 4" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </span>
                    <input class="profile-input" id="profileActivity" name="activity" type="text" placeholder="Госзакупки (Медицина)">
                  </div>
                </div>
                <div class="profile-field profile-field--full">
                  <label for="profileAge">Возраст</label>
                  <div class="profile-input-wrap">
                    <span class="profile-input-icon" aria-hidden="true">
                      <svg viewBox="0 0 20 20">
                        <rect x="3" y="4.5" width="14" height="12" rx="2" ry="2" fill="none" stroke="currentColor" stroke-width="1.4"/>
                        <path d="M6 3.5v2M14 3.5v2M3 8h14" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                      </svg>
                    </span>
                    <input class="profile-input" id="profileAge" name="age" type="text" placeholder="Например: 35">
                  </div>
                </div>
              </div>
            </form>
            <div class="profile-modal__footer">
              <button class="profile-btn ghost" type="button" id="profileModalCancel">Отмена</button>
              <button class="profile-btn primary" type="submit" form="profileForm">
                <span class="profile-btn__icon" aria-hidden="true">
                  <svg viewBox="0 0 20 20">
                    <path d="M4 4h9l3 3v9a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1z" fill="none" stroke="currentColor" stroke-width="1.4"/>
                    <path d="M6 4v5h8" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                    <rect x="6" y="11" width="8" height="5" rx="1" fill="none" stroke="currentColor" stroke-width="1.4"/>
                  </svg>
                </span>
                Сохранить
              </button>
            </div>
          </div>
          <div class="profile-tab-panel" data-panel="security">
            <form id="securityForm">
              <div class="profile-form__grid">
                <div class="profile-field profile-field--full">
                  <label for="currentPassword">Текущий пароль</label>
                  <div class="profile-input-wrap profile-input-wrap--secure">
                    <span class="profile-input-icon" aria-hidden="true">
                      <svg viewBox="0 0 20 20">
                        <circle cx="7" cy="11" r="3" fill="none" stroke="currentColor" stroke-width="1.4"/>
                        <path d="M10 11h7M14 11v2M16 11v2" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                      </svg>
                    </span>
                    <input class="profile-input" id="currentPassword" name="current_password" type="password" placeholder="********">
                  </div>
                </div>
                <div class="profile-field profile-field--full">
                  <label for="newPassword">Новый пароль</label>
                  <div class="profile-input-wrap profile-input-wrap--secure">
                    <span class="profile-input-icon" aria-hidden="true">
                      <svg viewBox="0 0 20 20">
                        <rect x="4" y="9" width="12" height="8" rx="2" fill="none" stroke="currentColor" stroke-width="1.4"/>
                        <path d="M6.5 9V6.5a3.5 3.5 0 1 1 7 0V9" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                      </svg>
                    </span>
                    <input class="profile-input" id="newPassword" name="new_password" type="password" placeholder="********">
                  </div>
                </div>
                <div class="profile-field profile-field--full">
                  <label for="confirmPassword">Подтвердите пароль</label>
                  <div class="profile-input-wrap profile-input-wrap--secure">
                    <span class="profile-input-icon" aria-hidden="true">
                      <svg viewBox="0 0 20 20">
                        <rect x="4" y="9" width="12" height="8" rx="2" fill="none" stroke="currentColor" stroke-width="1.4"/>
                        <path d="M6.5 9V6.5a3.5 3.5 0 1 1 7 0V9" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                      </svg>
                    </span>
                    <input class="profile-input" id="confirmPassword" name="confirm_password" type="password" placeholder="********">
                  </div>
                </div>
              </div>
            </form>
            <div class="profile-form__notice" id="securityError" role="alert"></div>
            <div class="profile-modal__footer">
              <button class="profile-btn ghost" type="button" id="securityCancel">Отмена</button>
              <button class="profile-btn primary" type="submit" form="securityForm">
                <span class="profile-btn__icon" aria-hidden="true">
                  <svg viewBox="0 0 20 20">
                    <path d="M4 4h9l3 3v9a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1z" fill="none" stroke="currentColor" stroke-width="1.4"/>
                    <path d="M6 4v5h8" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
                    <rect x="6" y="11" width="8" height="5" rx="1" fill="none" stroke="currentColor" stroke-width="1.4"/>
                  </svg>
                </span>
                Обновить пароль
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      (function () {
        /* ========= ТРЕКЕР ГОТОВНОСТИ МОДУЛЕЙ ========= */
        var AppModules = (function () {
          var readyFlags = {};
          var waiters = {};

          function markReady(name) {
            if (!name || readyFlags[name]) return;
            readyFlags[name] = true;
            if (waiters[name]) {
              waiters[name].forEach(function (resolve) { resolve(); });
              delete waiters[name];
            }
          }

          function waitReady(name) {
            if (readyFlags[name]) return Promise.resolve();
            return new Promise(function (resolve) {
              if (!waiters[name]) waiters[name] = [];
              waiters[name].push(resolve);
            });
          }

          function isReady(name) {
            return !!readyFlags[name];
          }

          return {
            markReady: markReady,
            waitReady: waitReady,
            isReady: isReady
          };
        })();
        window.AppModules = AppModules;

        var loadingOverlayEl = null;
        var loadingHintTimer = null;
        var loadingPercentTimer = null;
        var loadingHints = [
          'Настраиваемся на работу...',
          'Готовим контракты...',
          'Выставляем счета...',
          'Платим налоги...',
          'Выводим прибыль...',
          'Сверяем остатки по складу...',
          'Собираем подписантов...',
          'Печатаем акт о проделанной загрузке...',
          'Считаем бонусы бухгалтеру...',
          'Пересчитываем виртуальный НДС...'
        ];

        function showAppLoading() {
          if (!loadingOverlayEl) loadingOverlayEl = document.getElementById('appLoadingOverlay');
          if (loadingOverlayEl) loadingOverlayEl.classList.remove('hidden');
        }

        function hideAppLoading() {
          if (!loadingOverlayEl) loadingOverlayEl = document.getElementById('appLoadingOverlay');
          if (loadingOverlayEl) loadingOverlayEl.classList.add('hidden');
        }

        function shuffleHints(arr) {
          var a = arr.slice();
          for (var i = a.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            var tmp = a[i];
            a[i] = a[j];
            a[j] = tmp;
          }
          return a;
        }

        function startLoadingHints() {
          var hintEl = document.getElementById('appLoadingHint');
          if (!hintEl) return;
          var hints = shuffleHints(loadingHints);
          var idx = 0;
          hintEl.textContent = hints[idx] || '';
          if (loadingHintTimer) clearInterval(loadingHintTimer);
          loadingHintTimer = setInterval(function () {
            idx = (idx + 1) % hints.length;
            hintEl.textContent = hints[idx] || '';
          }, 1400);
        }

        function stopLoadingHints() {
          if (loadingHintTimer) clearInterval(loadingHintTimer);
          loadingHintTimer = null;
        }

        function startLoadingPercent() {
          var percentEl = document.getElementById('appLoadingPercent');
          var chipEl = document.getElementById('appLoadingChipPercent');
          if (!percentEl && !chipEl) return;
          var tick = function () {
            var value = Math.floor(Math.random() * 100);
            var text = value + '%';
            if (percentEl) percentEl.textContent = text;
            if (chipEl) chipEl.textContent = text;
          };
          tick();
          if (loadingPercentTimer) clearInterval(loadingPercentTimer);
          loadingPercentTimer = setInterval(tick, 180);
        }

        function stopLoadingPercent() {
          if (loadingPercentTimer) clearInterval(loadingPercentTimer);
          loadingPercentTimer = null;
        }

        /* ========= ТАБЫ ========= */
        var tabs = []; // {id, module, title}
        var activeTabId = null;
        var nextTabId = 1;
        var moduleTitles = {
          home: 'Главная',
          contracts: 'Реестр контрактов',
          analytics: 'Аналитика',
          warehouse: 'Склад',
          commercials: 'Коммерческие',
          pricelist: 'Прайс-лист'
        };
        function highlightMenu(module) {
          var items = document.querySelectorAll('.left-menu-item');
          Array.prototype.forEach.call(items, function (it) {
            if (it.getAttribute('data-section') === module) it.classList.add('active');
            else it.classList.remove('active');
          });
        }
        // Хранилище DOM-состояний вкладок
        // tabId -> { toolbarEl, subToolbarEl, dataAreaEl, bottomPanelEl, scrollTop }
        var tabDomStates = {};
        var contentContainer = null;
        var bottomPanelTemplateHtml =
          '<div class="chart-block">' +
            '<div id="bottomPanelTitle1" class="chart-title">Панель 1</div>' +
            '<div style="font-size:var(--font-size-small);color:var(--on-surface-secondary-color);">Пусто</div>' +
          '</div>' +
          '<div class="chart-block">' +
            '<div id="bottomPanelTitle2" class="chart-title">Панель 2</div>' +
            '<div style="font-size:var(--font-size-small);color:var(--on-surface-secondary-color);">Пусто</div>' +
          '</div>';
        function openModuleTab(module) {
          // ищем уже открытую вкладку
          var existing = tabs.find(function (t) { return t.module === module; });
          if (existing) {
            setActiveTab(existing.id);
            return;
          }
          // создаём новую
          var id = 'tab_' + (nextTabId++);
          var title = moduleTitles[module] || module;
          tabs.push({ id: id, module: module, title: title });
          setActiveTab(id);
        }
        function setActiveTab(tabId) {
          if (activeTabId === tabId) return;
          // ---- 1. Сохраняем DOM текущей вкладки (если был активный таб) ----
          if (activeTabId && contentContainer) {
            var curToolbar = document.getElementById('tabToolbar');
            var curSub = document.getElementById('subToolbar');
            var curData = document.getElementById('dataArea');
            var curBottom = contentContainer.querySelector('.bottom-panel');
            if (curToolbar && curSub && curData && curBottom) {
              var state = {
                toolbarEl: curToolbar,
                subToolbarEl: curSub,
                dataAreaEl: curData,
                bottomPanelEl: curBottom,
                scrollTop: curData.scrollTop || 0
              };
              tabDomStates[activeTabId] = state;
              // вынимаем узлы из DOM (но не уничтожаем)
              contentContainer.removeChild(curToolbar);
              contentContainer.removeChild(curSub);
              contentContainer.removeChild(curData);
              contentContainer.removeChild(curBottom);
            }
          }
          activeTabId = tabId;
          window.__activeTabId = activeTabId;
          renderTabs();
          var tab = tabs.find(function (t) { return t.id === tabId; });
          window.__activeModule = tab ? tab.module : null;
          highlightMenu(window.__activeModule);
          if (!tab) {
            setToolbarContent('');
            setSubtoolbarContent('');
            setDataAreaContent('');
            return;
          }
          // ---- 2. Восстанавливаем или создаём DOM для новой вкладки ----
          var domState = tabDomStates[tabId];
          if (contentContainer) {
            if (domState) {
              // Вкладка уже открывалась раньше — просто возвращаем её DOM
              contentContainer.appendChild(domState.toolbarEl);
              contentContainer.appendChild(domState.subToolbarEl);
              contentContainer.appendChild(domState.dataAreaEl);
              contentContainer.appendChild(domState.bottomPanelEl);
              // восстановим скролл
              if (domState.dataAreaEl) {
                domState.dataAreaEl.scrollTop = domState.scrollTop || 0;
              }
            } else {
              // Первая активация вкладки — создаём "скелет" элементов
              var toolbarElNew = document.createElement('div');
              toolbarElNew.id = 'tabToolbar';
              toolbarElNew.className = 'tab-toolbar';
              var subElNew = document.createElement('div');
              subElNew.id = 'subToolbar';
              subElNew.className = 'subtoolbar';
              var dataElNew = document.createElement('div');
              dataElNew.id = 'dataArea';
              dataElNew.className = 'data-area';
              var bottomElNew = document.createElement('div');
              bottomElNew.className = 'bottom-panel';
              bottomElNew.innerHTML = bottomPanelTemplateHtml;
              contentContainer.appendChild(toolbarElNew);
              contentContainer.appendChild(subElNew);
              contentContainer.appendChild(dataElNew);
              contentContainer.appendChild(bottomElNew);
              // ---- 3. Первый раз открыли модуль — вызываем его load() ----
              if (tab.module === 'home' && typeof UIHome !== 'undefined') {
                UIHome.load();
              } else if (tab.module === 'contracts' && typeof UIContracts !== 'undefined') {
                UIContracts.load();
              } else if (tab.module === 'analytics' && typeof UIAnalytics !== 'undefined') {
                UIAnalytics.load();
              } else if (tab.module === 'warehouse' && typeof UIWarehouse !== 'undefined') {
                UIWarehouse.load();
              } else if (tab.module === 'commercials' && typeof UICommercials !== 'undefined') {
                UICommercials.load();
              } else if (tab.module === 'pricelist' && typeof UIPricelist !== 'undefined') {
                UIPricelist.load();
              }
            }
            if (tab.module === 'home' && typeof UIHome !== 'undefined' && UIHome.onResume) {
              UIHome.onResume();
            } else if (tab.module === 'contracts' && typeof UIContracts !== 'undefined' && UIContracts.onResume) {
              UIContracts.onResume();
            } else if (tab.module === 'analytics' && typeof UIAnalytics !== 'undefined' && UIAnalytics.onResume) {
              UIAnalytics.onResume();
            } else if (tab.module === 'warehouse' && typeof UIWarehouse !== 'undefined' && UIWarehouse.onResume) {
              UIWarehouse.onResume();
            } else if (tab.module === 'commercials' && typeof UICommercials !== 'undefined' && UICommercials.onResume) {
              UICommercials.onResume();
            } else if (tab.module === 'pricelist' && typeof UIPricelist !== 'undefined' && UIPricelist.onResume) {
              UIPricelist.onResume();
            }
          }
        }
        function createTabGuard(module) {
          var tabId = activeTabId;
          var moduleName = module;
          return {
            isActive: function () {
              return window.__activeModule === moduleName && activeTabId === tabId;
            }
          };
        }
        window.createTabGuard = createTabGuard;
        function renderTabs() {
          var tabsDiv = document.getElementById('tabs');
          if (!tabsDiv) return;
          var html = '';
          tabs.forEach(function (t) {
            html += '<div class="tab' + (t.id === activeTabId ? ' active' : '') + '" data-id="' + t.id + '">' +
              '<span>' + t.title + '</span>' +
              '<span class="tab-close" data-close="' + t.id + '">×</span>' +
              '</div>';
          });
          tabsDiv.innerHTML = html;
          Array.prototype.forEach.call(
            tabsDiv.querySelectorAll('.tab'),
            function (el) {
              el.addEventListener('click', function (e) {
                var closeId = e.target.getAttribute('data-close');
                if (closeId) {
                  closeTab(closeId);
                  e.stopPropagation();
                  return;
                }
                var id = el.getAttribute('data-id');
                setActiveTab(id);
              });
            }
          );
        }
        function closeTab(tabId) {
          var idx = tabs.findIndex(function (t) { return t.id === tabId; });
          if (idx === -1) return;
          // удаляем сохранённое DOM-состояние вкладки
          delete tabDomStates[tabId];
          tabs.splice(idx, 1);
          if (activeTabId === tabId) {
            if (tabs.length > 0) {
              setActiveTab(tabs[tabs.length - 1].id);
            } else {
              activeTabId = null;
              renderTabs();
              setToolbarContent('');
              setSubtoolbarContent('');
              setDataAreaContent('');
            }
          } else {
            renderTabs();
          }
        }
        window.openModuleTab = openModuleTab;
        /* ========= ХЕЛПЕРЫ ДЛЯ КОНТЕНТА ВКЛАДКИ ========= */
        function setToolbarContent(html) {
          var el = document.getElementById('tabToolbar');
          if (el) el.innerHTML = html;
        }
        function setSubtoolbarContent(html) {
          var el = document.getElementById('subToolbar');
          if (el) el.innerHTML = html;
        }
        function setDataAreaContent(html) {
          var el = document.getElementById('dataArea');
          if (el) {
            el.innerHTML = html;
            // при явной смене контента сбрасываем скролл
            el.scrollTop = 0;
          }
        }
        function setBottomPanelTitles(t1, t2) {
          var el1 = document.getElementById('bottomPanelTitle1');
          var el2 = document.getElementById('bottomPanelTitle2');
          if (el1) el1.textContent = t1 || '';
          if (el2) el2.textContent = t2 || '';
        }
        window.setToolbarContent      = setToolbarContent;
        window.setSubtoolbarContent   = setSubtoolbarContent;
        window.setDataAreaContent     = setDataAreaContent;
        window.setBottomPanelTitles   = setBottomPanelTitles;
        /* ========= РЕЗАЙЗ КОЛОНОК ========= */
        function makeTableResizable(table) {
          if (!table) return;
          var ths = table.querySelectorAll('th');
          Array.prototype.forEach.call(ths, function (th) {
            var resizer = th.querySelector('.col-resizer');
            if (!resizer) {
              resizer = document.createElement('div');
              resizer.className = 'col-resizer';
              th.appendChild(resizer);
            }
            var startX, startWidth;
            resizer.onmousedown = function (e) {
              e.preventDefault();
              startX = e.pageX;
              startWidth = th.offsetWidth;
              document.addEventListener('mousemove', onMouseMove);
              document.addEventListener('mouseup', onMouseUp);
            };
            function onMouseMove(e) {
              var diff = e.pageX - startX;
              var newWidth = startWidth + diff;
              if (newWidth < 40) newWidth = 40;
              th.style.width = newWidth + 'px';
            }
            function onMouseUp() {
              document.removeEventListener('mousemove', onMouseMove);
              document.removeEventListener('mouseup', onMouseUp);
            }
          });
        }
        window.makeTableResizable = makeTableResizable;
        /* ========= ОБЩИЙ МЕНЕДЖЕР СТРОК ========= */
        var RowSelection = (function () {
          var currentRows = [];
          var selectedIds = new Set();
          var currentOptions = null;
          var menuEl = null;
          var outsideHandlerBound = false;
          function attach(table, options) {
            if (!table) return;
            currentOptions = options || {};
            currentRows = Array.from(
              table.querySelectorAll(options.rowSelector || 'tr.data-row')
            );
            selectedIds.clear();
            currentRows.forEach(function (r) {
              r.classList.remove('data-row-selected');
            });
            ensureMenu();
            rebuildMenu();
            bindOutsideClear();
            currentRows.forEach(function (row) {
              var id = row.getAttribute(options.idAttr || 'data-id');
              if (!id) return;
              // одиночный клик: выбор/мультивыбор
              row.addEventListener('click', function (e) {
                if (e.detail > 1) return; // не мешаем dblclick
                if (e.ctrlKey || e.metaKey) {
                  toggleSelection(row, id);
                } else {
                  clearSelection();
                  selectRow(row, id);
                }
              });
              // двойной клик: редактирование
              row.addEventListener('dblclick', function (e) {
                e.preventDefault();
                if (currentOptions.onEdit) {
                  currentOptions.onEdit(id);
                }
              });
              // ПКМ: контекстное меню
              row.addEventListener('contextmenu', function (e) {
                e.preventDefault();
                if (e.ctrlKey || e.metaKey) {
                  toggleSelection(row, id);
                } else if (!selectedIds.has(id)) {
                  clearSelection();
                  selectRow(row, id);
                }
                if (selectedIds.size === 0) {
                  selectRow(row, id);
                }
                openMenu(e.pageX, e.pageY);
              });
            });
          }
          function selectRow(row, id) {
            row.classList.add('data-row-selected');
            selectedIds.add(id);
          }
          function clearSelection() {
            currentRows.forEach(function (r) {
              r.classList.remove('data-row-selected');
            });
            selectedIds.clear();
          }
          function toggleSelection(row, id) {
            if (selectedIds.has(id)) {
              selectedIds.delete(id);
              row.classList.remove('data-row-selected');
            } else {
              selectedIds.add(id);
              row.classList.add('data-row-selected');
            }
          }
          function onOutsideMouseDown(e) {
            if (!currentRows || !currentRows.length) return;
            if (menuEl && menuEl.contains(e.target)) return;
            var selector = (currentOptions && currentOptions.rowSelector) || 'tr.data-row';
            if (e.target.closest(selector)) return;
            clearSelection();
            hideMenu();
          }
          function bindOutsideClear() {
            if (outsideHandlerBound) return;
            document.addEventListener('mousedown', onOutsideMouseDown);
            outsideHandlerBound = true;
          }
          /* ===== контекстное меню ===== */
          function ensureMenu() {
            if (menuEl) return;
            menuEl = document.createElement('div');
            menuEl.className = 'row-context-menu';
            menuEl.style.display = 'none';
            document.body.appendChild(menuEl);
            menuEl.addEventListener('click', function (e) {
              var action = e.target.getAttribute('data-action');
              if (!action) return;
              var ids = Array.from(selectedIds);
              hideMenu();
              if (!currentOptions) return;
              if (action === 'moves') {
                // Посмотреть движения товара
                if (!currentOptions.onViewMoves) return;
                currentOptions.onViewMoves(ids, currentRows);
              } else if (action === 'edit') {
                if (!currentOptions.onEdit) return;
                if (ids.length !== 1) {
                  AppDialog.alert('Для редактирования выберите одну строку.', 'Редактирование');
                  return;
                }
                currentOptions.onEdit(ids[0]);
              } else if (action === 'delete') {
                if (!currentOptions.onDelete) return;
                if (!ids.length) return;
                currentOptions.onDelete(ids);
              } else if (currentOptions.onMenu) {
                currentOptions.onMenu(action, ids, currentRows);
              }
            });
            document.addEventListener('click', function () {
              hideMenu();
            });
            document.addEventListener('scroll', function () {
              hideMenu();
            }, true);
          }
          function rebuildMenu() {
            if (!menuEl) return;
            var html = '';
            if (currentOptions && currentOptions.customMenu && currentOptions.customMenu.length) {
              currentOptions.customMenu.forEach(function (item) {
                if (!item || !item.action || !item.label) return;
                var cls = 'row-context-item';
                if (item.danger) cls += ' row-context-item-danger';
                html += '<div class="' + cls + '" data-action="' + item.action + '">' + item.label + '</div>';
              });
            }
            // «Посмотреть движения товара» показываем только там, где есть обработчик
            if (currentOptions && currentOptions.onViewMoves) {
              html += '<div class="row-context-item" data-action="moves">Посмотреть движения товара</div>';
            }
            // Редактировать — если есть обработчик
            if (currentOptions && currentOptions.onEdit) {
              html += '<div class="row-context-item" data-action="edit">Редактировать</div>';
            }
            // Удалить — если есть обработчик
            if (currentOptions && currentOptions.onDelete) {
              html += '<div class="row-context-item row-context-item-danger" data-action="delete">Удалить</div>';
            }
            menuEl.innerHTML = html;
          }
          function openMenu(x, y) {
            if (!menuEl) return;
            // если нет ни одного пункта — не показываем меню
            if (!menuEl.innerHTML.trim()) return;
            menuEl.style.left = x + 'px';
            menuEl.style.top  = y + 'px';
            menuEl.style.display = 'block';
          }
          function hideMenu() {
            if (menuEl) menuEl.style.display = 'none';
          }
          return {
            attach: attach
          };
        })();
        window.RowSelection = RowSelection;
        /* ========= МОДАЛЬНЫЕ ОКНА ПРИЛОЖЕНИЯ ========= */
        var AppDialog = (function () {
          var overlay, titleEl, msgEl, buttonsEl;
          function init() {
            if (overlay) return;
            overlay   = document.getElementById('appDialogOverlay');
            titleEl   = document.getElementById('appDialogTitle');
            msgEl     = document.getElementById('appDialogMessage');
            buttonsEl = document.getElementById('appDialogButtons');
          }
          function show() {
            init();
            overlay.style.display = 'flex';
          }
          function hide() {
            if (!overlay) return;
            overlay.style.display = 'none';
            buttonsEl.innerHTML = '';
          }
          function alert(message, title, onClose) {
            init();
            titleEl.textContent = title || 'Сообщение';
            msgEl.textContent   = message || '';
            buttonsEl.innerHTML = '';
            var btnOk = document.createElement('button');
            btnOk.className = 'dialog-btn dialog-btn-primary';
            btnOk.textContent = 'OK';
            btnOk.onclick = function () {
              hide();
              if (onClose) onClose();
            };
            buttonsEl.appendChild(btnOk);
            show();
          }
          function confirm(message, onYes, onNo, title) {
            init();
            titleEl.textContent = title || 'Подтверждение';
            msgEl.textContent   = message || '';
            buttonsEl.innerHTML = '';
            var btnNo = document.createElement('button');
            btnNo.className = 'dialog-btn dialog-btn-secondary';
            btnNo.textContent = 'Отмена';
            btnNo.onclick = function () {
              hide();
              if (onNo) onNo();
            };
            var btnYes = document.createElement('button');
            btnYes.className = 'dialog-btn dialog-btn-primary';
            btnYes.textContent = 'Да';
            btnYes.onclick = function () {
              hide();
              if (onYes) onYes();
            };
            buttonsEl.appendChild(btnNo);
            buttonsEl.appendChild(btnYes);
            show();
          }
          return {
            alert: alert,
            confirm: confirm
          };
        })();
        window.AppDialog = AppDialog;

        /* ========= ПРЕЛОАДЕР ПРИЛОЖЕНИЯ ========= */
        var preloaderModules = ['contracts', 'commercials', 'warehouse', 'pricelist', 'analytics'];

        function bindLeftMenuClicks() {
          var items = document.querySelectorAll('.left-menu-item');
          Array.prototype.forEach.call(items, function (item) {
            item.addEventListener('click', function () {
              var section = item.getAttribute('data-section');
              highlightMenu(section);
              openModuleTab(section);
            });
          });
        }

        function bindProfileMenu() {
          var toggle = document.getElementById('profileMenuToggle');
          var menu = document.getElementById('profileMenu');
          if (!toggle || !menu) return;
          var wrapper = toggle.closest('.profile-menu');
          if (!wrapper) return;
          var accountsBox = document.getElementById('profileAccounts');
          var accountsList = document.getElementById('profileAccountsList');
          var closeMenu = function () {
            wrapper.classList.remove('is-open');
            toggle.setAttribute('aria-expanded', 'false');
            menu.setAttribute('aria-hidden', 'true');
          };
          var openMenu = function () {
            wrapper.classList.add('is-open');
            toggle.setAttribute('aria-expanded', 'true');
            menu.setAttribute('aria-hidden', 'false');
          };
          toggle.addEventListener('click', function (e) {
            e.stopPropagation();
            if (wrapper.classList.contains('is-open')) {
              closeMenu();
            } else {
              openMenu();
            }
          });
          document.addEventListener('click', function (e) {
            if (!wrapper.contains(e.target)) closeMenu();
          });
          document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') closeMenu();
          });
          var buildInitials = function (name) {
            var cleaned = (name || '').trim();
            if (!cleaned) return 'АД';
            var parts = cleaned.split(/\s+/);
            if (parts.length >= 2) {
              return (parts[0][0] || '') + (parts[1][0] || '');
            }
            return cleaned.slice(0, 2);
          };
          var renderAccounts = function (accounts) {
            var currentUserId = wrapper.getAttribute('data-current-user-id');
            if (!accountsBox || !accountsList) return;
            accountsList.innerHTML = '';
            if (!accounts || !accounts.length) {
              accountsBox.setAttribute('aria-hidden', 'true');
              return;
            }
            accountsBox.setAttribute('aria-hidden', 'false');
            accounts.forEach(function (account) {
              var item = document.createElement('div');
              item.className = 'profile-account';
              if (String(account.id) === String(currentUserId)) {
                item.classList.add('is-current');
              }
              var avatar = document.createElement('div');
              avatar.className = 'profile-account__avatar';
              avatar.textContent = buildInitials(account.name).toUpperCase();
              var meta = document.createElement('div');
              meta.className = 'profile-account__meta';
              var nameEl = document.createElement('div');
              nameEl.className = 'profile-account__name';
              nameEl.textContent = account.name || account.email || 'Аккаунт';
              var emailEl = document.createElement('div');
              emailEl.className = 'profile-account__email';
              emailEl.textContent = account.email || ' ';
              meta.appendChild(nameEl);
              meta.appendChild(emailEl);
              var removeBtn = document.createElement('span');
              removeBtn.className = 'profile-account__remove';
              removeBtn.title = 'Удалить с устройства';
              removeBtn.textContent = '×';
              item.appendChild(avatar);
              item.appendChild(meta);
              item.appendChild(removeBtn);
              if (!item.classList.contains('is-current')) {
                item.addEventListener('click', function () {
                  fetch('/auth/switch/' + account.id, {
                    method: 'POST',
                    headers: { 'Accept': 'application/json', 'X-Requested-With': 'fetch' }
                  })
                    .then(function (res) { return res.json(); })
                    .then(function (data) {
                      if (data && data.redirect) {
                        window.location.href = data.redirect;
                      }
                    })
                    .catch(function () {});
                });
              }
              removeBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                if (window.AppDialog && typeof window.AppDialog.confirm === 'function') {
                  window.AppDialog.confirm(
                    'Удалить с устройства?',
                    function () {
                      fetch('/auth/accounts/' + account.id + '/remove', {
                        method: 'POST',
                        headers: { 'Accept': 'application/json', 'X-Requested-With': 'fetch' }
                      })
                        .then(function () { refreshAccounts(); })
                        .catch(function () {});
                    },
                    null,
                    'Удаление аккаунта'
                  );
                  return;
                }
                fetch('/auth/accounts/' + account.id + '/remove', {
                  method: 'POST',
                  headers: { 'Accept': 'application/json', 'X-Requested-With': 'fetch' }
                })
                  .then(function () { refreshAccounts(); })
                  .catch(function () {});
              });
              accountsList.appendChild(item);
            });
          };
          var refreshAccounts = function () {
            fetch('/auth/accounts', { headers: { 'Accept': 'application/json' } })
              .then(function (res) { return res.json(); })
              .then(function (data) {
                if (data && data.accounts) renderAccounts(data.accounts);
              })
              .catch(function () {});
          };
          refreshAccounts();
          var originalOpenMenu = openMenu;
          openMenu = function () {
            originalOpenMenu();
            refreshAccounts();
          };
        }

        function bindProfileModal() {
          var openBtn = document.getElementById('profileSettingsBtn');
          var modal = document.getElementById('profileModal');
          var closeBtn = document.getElementById('profileModalClose');
          var cancelBtn = document.getElementById('profileModalCancel');
          var securityCancelBtn = document.getElementById('securityCancel');
          var form = document.getElementById('profileForm');
          var securityForm = document.getElementById('securityForm');
          var securityError = document.getElementById('securityError');
          var tabs = modal ? modal.querySelectorAll('.profile-tab') : [];
          var panels = modal ? modal.querySelectorAll('.profile-tab-panel') : [];
          if (!openBtn || !modal || !form) return;
          var buildProfileDisplay = function (profile) {
            var firstName = ((profile && profile.first_name) || '').trim();
            var lastName = ((profile && profile.last_name) || '').trim();
            var fullName = ((profile && profile.full_name) || '').trim();
            var displayName = '';
            if (firstName || lastName) {
              displayName = [firstName, lastName].filter(Boolean).join(' ');
            } else {
              displayName = fullName;
            }
            if (!displayName) displayName = 'Администратор';
            var initials = '';
            if (firstName && lastName) {
              initials = (firstName[0] || '') + (lastName[0] || '');
            } else {
              var base = firstName || lastName || displayName;
              initials = (base || '').slice(0, 2);
            }
            initials = initials.toUpperCase();
            return { name: displayName, initials: initials };
          };
          var updateProfileDisplay = function (profile) {
            var display = buildProfileDisplay(profile || {});
            var nameEl = document.querySelector('.profile-dropdown__name');
            if (nameEl) nameEl.textContent = display.name;
            var avatarEl = document.getElementById('profileMenuToggle');
            if (avatarEl) avatarEl.textContent = display.initials || 'АД';
            var roleEl = document.querySelector('.profile-dropdown__role');
            if (roleEl) roleEl.textContent = (profile && profile.activity) ? profile.activity : ' ';
            var welcomeEl = document.getElementById('homeWelcomeName');
            if (welcomeEl) welcomeEl.textContent = 'Добро пожаловать назад, ' + display.name;
          };
          var setTab = function (name) {
            Array.prototype.forEach.call(tabs, function (tab) {
              var active = tab.getAttribute('data-tab') === name;
              tab.classList.toggle('is-active', active);
              tab.setAttribute('aria-selected', active ? 'true' : 'false');
            });
            Array.prototype.forEach.call(panels, function (panel) {
              panel.classList.toggle('is-active', panel.getAttribute('data-panel') === name);
            });
            if (securityError) {
              securityError.textContent = '';
              securityError.style.display = 'none';
            }
          };
          var loadProfileDisplay = function () {
            fetch('/app/profile', { headers: { 'Accept': 'application/json', 'X-Requested-With': 'fetch' } })
              .then(function (res) { return res.json(); })
              .then(function (data) {
                if (data && data.profile) updateProfileDisplay(data.profile);
              })
              .catch(function () { updateProfileDisplay({}); });
          };
          var setOpen = function (value) {
            modal.classList.toggle('is-open', value);
            modal.setAttribute('aria-hidden', value ? 'false' : 'true');
          };
          var fillForm = function (profile) {
            document.getElementById('profileFirstName').value = (profile.first_name || '');
            document.getElementById('profileLastName').value = (profile.last_name || '');
            document.getElementById('profileActivity').value = (profile.activity || '');
            document.getElementById('profileAge').value = (profile.age || '');
            updateProfileDisplay(profile);
          };
          Array.prototype.forEach.call(tabs, function (tab) {
            tab.addEventListener('click', function () {
              setTab(tab.getAttribute('data-tab'));
            });
          });
          openBtn.addEventListener('click', function (e) {
            e.preventDefault();
            fetch('/app/profile', { headers: { 'Accept': 'application/json', 'X-Requested-With': 'fetch' } })
              .then(function (res) { return res.json(); })
              .then(function (data) {
                if (data && data.profile) fillForm(data.profile);
              })
              .catch(function () {})
              .finally(function () {
                setTab('profile');
                setOpen(true);
              });
          });
          if (closeBtn) closeBtn.addEventListener('click', function () { setOpen(false); });
          if (cancelBtn) cancelBtn.addEventListener('click', function () { setOpen(false); });
          if (securityCancelBtn) securityCancelBtn.addEventListener('click', function () { setOpen(false); });
          modal.addEventListener('click', function (e) {
            if (e.target === modal) setOpen(false);
          });
          document.addEventListener('mousedown', function (e) {
            if (!modal.classList.contains('is-open')) return;
            if (e.target.closest('.profile-input-wrap')) return;
            var active = document.activeElement;
            if (active && active.closest && active.closest('#profileModal')) {
              active.blur();
            }
          });
          form.addEventListener('submit', function (e) {
            e.preventDefault();
            var payload = new URLSearchParams(new FormData(form));
            fetch('/app/profile', {
              method: 'POST',
              headers: { 'X-Requested-With': 'fetch', 'Accept': 'application/json' },
              body: payload
            }).then(function () {
              var formProfile = {
                first_name: document.getElementById('profileFirstName').value,
                last_name: document.getElementById('profileLastName').value,
                activity: document.getElementById('profileActivity').value
              };
              updateProfileDisplay(formProfile);
              setOpen(false);
            });
          });
          if (securityForm) {
            securityForm.addEventListener('submit', function (e) {
              e.preventDefault();
              if (securityError) {
                securityError.textContent = '';
                securityError.style.display = 'none';
              }
              var payload = new URLSearchParams(new FormData(securityForm));
              fetch('/app/password/update', {
                method: 'POST',
                headers: { 'X-Requested-With': 'fetch', 'Accept': 'application/json' },
                body: payload
              })
                .then(function (res) { return res.json(); })
                .then(function (data) {
                  if (!data || data.success === false) {
                    var msg = (data && data.error) ? data.error : 'Не удалось обновить пароль.';
                    if (securityError) {
                      securityError.textContent = msg;
                      securityError.style.display = 'block';
                    }
                    return;
                  }
                  securityForm.reset();
                  if (window.AppDialog && typeof window.AppDialog.alert === 'function') {
                    window.AppDialog.alert('Пароль обновлен.', 'Безопасность');
                  }
                  setOpen(false);
                })
                .catch(function () {
                  if (securityError) {
                    securityError.textContent = 'Ошибка запроса.';
                    securityError.style.display = 'block';
                  }
                });
            });
          }
          loadProfileDisplay();
        }

        function bindSidebarToggle() {
          var btn = document.getElementById('toggleSidebarBtn');
          var appRoot = document.querySelector('.app-root');
          if (!btn || !appRoot) return;
          var updateLabel = function () {
            var collapsed = appRoot.classList.contains('sidebar-collapsed');
            btn.setAttribute('aria-label', collapsed ? 'Показать боковую панель' : 'Скрыть боковую панель');
          };
          btn.addEventListener('click', function () {
            appRoot.classList.toggle('sidebar-collapsed');
            updateLabel();
          });
          updateLabel();
        }

        function bindArchiveDownload() {
          var btn = document.getElementById('downloadArchiveBtn');
          if (!btn || typeof google === 'undefined' || !google.script || !google.script.run) return;
          btn.addEventListener('click', function () {
            if (btn.disabled) return;
            btn.disabled = true;
            google.script.run
              .withSuccessHandler(function (res) {
                btn.disabled = false;
                if (!res || !res.success || !res.data) {
                  var errorText = (res && res.error) ? res.error : 'Не удалось подготовить архив.';
                  AppDialog.alert(errorText, 'Скачивание');
                  return;
                }
                if (res.data.downloadUrl) {
                  var linkFallback = document.createElement('a');
                  linkFallback.href = res.data.downloadUrl;
                  linkFallback.target = '_blank';
                  linkFallback.rel = 'noopener';
                  document.body.appendChild(linkFallback);
                  linkFallback.click();
                  document.body.removeChild(linkFallback);
                  return;
                }
                AppDialog.alert('Не удалось подготовить архив.', 'Скачивание');
              })
              .withFailureHandler(function (err) {
                btn.disabled = false;
                AppDialog.alert('Ошибка скачивания: ' + (err && err.message ? err.message : err), 'Скачивание');
              })
              .appBackend({ module: 'archive', action: 'downloadProjectArchive', payload: {} });
          });
        }

        function waitWithTimeout(promise, ms) {
          var fallback = new Promise(function (resolve) { setTimeout(resolve, ms); });
          return Promise.race([promise, fallback]);
        }

        function preloadModule(module) {
          try {
            if (module === 'contracts'   && typeof UIContracts   !== 'undefined' && UIContracts.preload)   return UIContracts.preload();
            if (module === 'commercials' && typeof UICommercials !== 'undefined' && UICommercials.preload) return UICommercials.preload();
            if (module === 'warehouse'   && typeof UIWarehouse   !== 'undefined' && UIWarehouse.preload)   return UIWarehouse.preload();
            if (module === 'pricelist'   && typeof UIPricelist   !== 'undefined' && UIPricelist.preload)   return UIPricelist.preload();
            if (module === 'analytics'   && typeof UIAnalytics   !== 'undefined' && UIAnalytics.preload)   return UIAnalytics.preload();
          } catch (e) {}
          return Promise.resolve();
        }

        function startInitialLoad() {
          showAppLoading();
          startLoadingHints();
          startLoadingPercent();

          openModuleTab('home');

          waitWithTimeout(AppModules.waitReady('home'), 6000)
            .catch(function () {})
            .then(function () {
              stopLoadingHints();
              stopLoadingPercent();
              hideAppLoading();
              highlightMenu('home');
            });

          preloaderModules.forEach(function (module) {
            Promise.resolve()
              .then(function () { return preloadModule(module); })
              .then(function () { return waitWithTimeout(AppModules.waitReady(module), 12000); })
              .catch(function () { return Promise.resolve(); });
          });
        }
        /* ========= ИНИЦИАЛИЗАЦИЯ ========= */
        window.onload = function () {
          // контейнер, в котором живут тулбар, сабтулбар, dataArea и bottom-panel
          contentContainer = document.querySelector('.tab-content');
          bindLeftMenuClicks();
          bindProfileMenu();
          bindProfileModal();
          bindSidebarToggle();
          bindArchiveDownload();
          startInitialLoad();
        };
        /* ========= НОВЫЙ КАЛЕНДАРЬ ======== */
        // Глобальные переменные для календаря
        var dpOverlay = null;
        var dpInput = null;
        var dpMonth = null;
        var dpYear = null;
        // Инициализация календаря
        function ensureDatePickerOverlay() {
          if (dpOverlay) return;
          dpOverlay = document.createElement('div');
          dpOverlay.className = 'calendar-popup';
          dpOverlay.style.display = 'none';
          document.body.appendChild(dpOverlay);
          // Закрытие при клике вне
          document.addEventListener('mousedown', function (e) {
            if (!dpOverlay || dpOverlay.style.display === 'none') return;
            if (dpOverlay.contains(e.target) || (dpInput && dpInput.contains(e.target))) return;
            hideDatePicker();
          });
        }
        function triggerDateInputChange() {
          if (!dpInput) return;
          var evInput = new Event('input', { bubbles: true });
          var evChange = new Event('change', { bubbles: true });
          dpInput.dispatchEvent(evInput);
          dpInput.dispatchEvent(evChange);
        }
        // Показать календарь
        function getScrollParent(el) {
          var parent = el ? el.parentElement : null;
          while (parent && parent !== document.body) {
            var style = window.getComputedStyle(parent);
            var overflow = (style.overflow + style.overflowY + style.overflowX);
            if (/auto|scroll/i.test(overflow)) return parent;
            parent = parent.parentElement;
          }
          return document.body;
        }

        function ensureOverlayVisible(overlay, anchor) {
          if (!overlay) return;
          var margin = 12;
          var rect = overlay.getBoundingClientRect();
          var container = anchor ? getScrollParent(anchor) : document.body;
          if (container === document.body) {
            if (rect.bottom > window.innerHeight) {
              window.scrollBy(0, rect.bottom - window.innerHeight + margin);
            }
            if (rect.top < 0) {
              window.scrollBy(0, rect.top - margin);
            }
            return;
          }
          var contRect = container.getBoundingClientRect();
          var top = rect.top - contRect.top;
          var bottom = rect.bottom - contRect.top;
          if (bottom > container.clientHeight) {
            container.scrollTop += bottom - container.clientHeight + margin;
          }
          if (top < 0) {
            container.scrollTop += top - margin;
          }
        }

        function showDatePickerFor(input) {
          ensureDatePickerOverlay();
          dpInput = input;
          // Парсим текущую дату из поля
          var base = ruDateToDate(input.value) || new Date();
          dpMonth = base.getMonth();
          dpYear = base.getFullYear();
          renderDatePicker(base);

          if (dpOverlay.parentNode !== document.body) document.body.appendChild(dpOverlay);
          dpOverlay.style.position = 'fixed';
          dpOverlay.style.display = 'block';

          var rect = input.getBoundingClientRect();
          var overlayRect = dpOverlay.getBoundingClientRect();
          var margin = 8;

          var left = rect.left;
          var top = rect.bottom + 6;

          if (left + overlayRect.width > window.innerWidth - margin) {
            left = window.innerWidth - overlayRect.width - margin;
          }
          if (left < margin) left = margin;

          dpOverlay.style.left = left + 'px';
          dpOverlay.style.top = top + 'px';
          ensureOverlayVisible(dpOverlay, input);
        }
        // Скрыть календарь
        function hideDatePicker() {
          if (dpOverlay) dpOverlay.style.display = 'none';
          dpInput = null;
        }
        // Отрендерить календарь
        function renderDatePicker(selectedDate) {
          if (!dpOverlay || dpMonth === null || dpMonth === undefined) return;
          var months = ['Январь','Февраль','Март','Апрель','Май','Июнь','Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'];
          var week   = ['Пн','Вт','Ср','Чт','Пт','Сб','Вс'];
          var firstDay    = new Date(dpYear, dpMonth, 1);
          var start       = (firstDay.getDay() + 6) % 7; // Понедельник - 0
          var daysInMonth = new Date(dpYear, dpMonth + 1, 0).getDate();
          var selIso = selectedDate ? isoFromYMD(selectedDate.getFullYear(), selectedDate.getMonth(), selectedDate.getDate()) : '';
          var selRu  = selIso ? formatDateRu(selIso) : '';
          var today       = new Date();
          var todayIso    = isoFromYMD(today.getFullYear(), today.getMonth(), today.getDate());
          var todayRu     = formatDateRu(todayIso);
          var html = '';
          // Заголовок с навигацией
          html += '<div class="calendar-header">';
          html += '<div class="calendar-nav">';
          html += '<button class="calendar-nav-btn" data-dp-prev>‹</button>';
          html += '<button class="calendar-nav-btn" data-dp-next>›</button>';
          html += '</div>';
          html += '<div class="calendar-month-year">' + months[dpMonth] + ' ' + dpYear + '</div>';
          html += '</div>';
          // Дни недели
          html += '<div class="calendar-body">';
          for (var i = 0; i < 7; i++) {
            html += '<div class="calendar-day-name">' + week[i] + '</div>';
          }
          // Дни месяца
          var day = 1;
          for (var r = 0; r < 6; r++) {
            for (var c = 0; c < 7; c++) {
              var cell = '&nbsp;';
              if (!(r === 0 && c < start) && day <= daysInMonth) {
                var iso = isoFromYMD(dpYear, dpMonth, day);
                var ru  = formatDateRu(iso);
                var isToday = (ru === todayRu);
                var isSelected = (ru === selRu);
                var classes = 'calendar-day';
                if (isToday) classes += ' today';
                if (isSelected) classes += ' selected';
                cell = '<div class="' + classes + '" data-dp-day="' + ru + '">' + day + '</div>';
                day++;
              }
              html += '<div>' + cell + '</div>';
            }
            if (day > daysInMonth) break;
          }
          html += '</div>';
          // Футер с кнопками
          html += '<div class="calendar-footer">';
          html += '<button class="calendar-footer-btn" data-dp-clear>Очистить дату</button>';
          html += '<button class="calendar-footer-btn" data-dp-today>Сегодня</button>';
          html += '</div>';
          dpOverlay.innerHTML = html;
          // Обработчики событий
          dpOverlay.querySelector('[data-dp-prev]').onclick = function () {
            dpMonth--;
            if (dpMonth < 0) {
              dpMonth = 11;
              dpYear--;
            }
            renderDatePicker(selectedDate);
          };
          dpOverlay.querySelector('[data-dp-next]').onclick = function () {
            dpMonth++;
            if (dpMonth > 11) {
              dpMonth = 0;
              dpYear++;
            }
            renderDatePicker(selectedDate);
          };
          Array.prototype.forEach.call(
            dpOverlay.querySelectorAll('[data-dp-day]'),
            function (el) {
              el.onclick = function () {
                var val = el.getAttribute('data-dp-day');
                if (dpInput) {
                  dpInput.value = val;
                  triggerDateInputChange();
                  hideDatePicker();
                }
              };
            }
          );
          var btnToday = dpOverlay.querySelector('[data-dp-today]');
          if (btnToday) {
            btnToday.onclick = function () {
              var d   = new Date();
              var iso = isoFromYMD(d.getFullYear(), d.getMonth(), d.getDate());
              if (dpInput) {
                dpInput.value = formatDateRu(iso);
                triggerDateInputChange();
                hideDatePicker();
              }
            };
          }
          var btnClear = dpOverlay.querySelector('[data-dp-clear]');
          if (btnClear) {
            btnClear.onclick = function () {
              if (dpInput) {
                dpInput.value = '';
                triggerDateInputChange();
                hideDatePicker();
              }
            };
          }
        }
        // Вспомогательные функции
        function isoFromYMD(y, m, d) {
          return y + '-' + ('0' + (m + 1)).slice(-2) + '-' + ('0' + d).slice(-2);
        }
        function formatDateRu(dateStr) {
          if (!dateStr) return '';
          if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
            var p = dateStr.split('-');
            return p[2] + '.' + p[1] + '.' + p[0];
          }
          return dateStr;
        }
        function ruDateToDate(str) {
          if (!str) return null;
          var m = /^(\d{2})\.(\d{2})\.(\d{4})$/.exec(str);
          return m ? new Date(+m[3], +m[2] - 1, +m[1]) : null;
        }
        // Экспортируем функцию для использования в других модулях
        window.attachDateInput = function (id) {
          var input = document.getElementById(id);
          if (!input || input.dataset.dpAttached) return;
          input.dataset.dpAttached = '1';
          input.addEventListener('input', function () {
            var v = input.value;
            var d = v.replace(/\D/g, '');
            if (d.length === 8 && v.indexOf('.') === -1) {
              input.value = d.slice(0, 2) + '.' + d.slice(2, 4) + '.' + d.slice(4);
            }
          });
          input.addEventListener('focus', function () { showDatePickerFor(input); });
          input.addEventListener('click',  function () { showDatePickerFor(input); });
        };
        window.ensureOverlayVisible = ensureOverlayVisible;
      })();
    </script>
    <!-- Модули вкладок -->
    {% include 'partials/ui_home.html' %}
    {% include 'partials/ui_contracts.html' %}
    {% include 'partials/ui_warehouse.html' %}
    {% include 'partials/ui_pricelist.html' %}
    {% include 'partials/ui_commercials.html' %}
    {% include 'partials/ui_analytics.html' %}
  </body>
</html>
